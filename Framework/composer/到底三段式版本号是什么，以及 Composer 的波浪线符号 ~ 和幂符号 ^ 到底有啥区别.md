## 到底三段式版本号是什么，以及 Composer 的波浪线符号 ~ 和幂符号 ^ 到底有啥区别

来源：[http://blog.p2hp.com/archives/5309](http://blog.p2hp.com/archives/5309)

时间 2018-05-12 08:30:30


曾经见过太多乱写版本号的（其实现在比以前好很多了），好多 1.9.0 的下个版本必然是 2.0.0, 2.9.0 下个版本必须 3.0.0……主要还是因为之前对版本号的命名就没有规范，大家都是看心情写。后来    [semantic versioning][0]
得到推广，版本号取名的情况得到改善，但依然有很多人不知道三段式版本号是什么含义（各种培训学校你们教一下这些规范会死么……）。

简单来说（我也就是搬运一下，上面提到的网站说的更清楚），三段式版本号各个段的含义是：

``` 
大版本.小版本.补丁版本


```

先说最明显的补丁版本。如果你的软件或者库，之前有一些 bug 被修复了，此时补丁版本需要 +1。

再来说小版本号。如果你增加了新的功能，比如 RPG 游戏增加了自动拾取东西，或者你的代码库里增加了一个新的方法，用户升级了你的代码库也不会导致兼容问题（BC），那么小版本号 +1。

最后，如果你的软件完全重构了，或者你的代码库完全重构以至于用户升级了新的库必然导致兼容问题，那么大版本号 +1。

当然，还会有同时修改了 bug 并增加了功能的情况，总之如果前一位需要 +1，无论何种情况后面的位数都必须清零。

对于面向终端用户的软件，其实也用不着太严格，因为终端用户也不太关心版本（除了大版本号……，所以出现了 chrome 风格的版本号，火狐也跟着带坏……），但对于库文件作者，还是遵守版本号的好，因为你定的版本号，提供了很重要的信息给库调用者，他们需要通过你的版本号来判断是否要避免兼容性问题。

举个比较经典的例子，虽然 Symfony 2/3/4 用起来也都差不多，但是因为这三个版本之间已经出现接口不一致的情况，所以大版本号必须得 +1。如果你的库文件有接口改变导致不兼容之前版本，哪怕只有一个，也应该将大版本号 +1 。

而如果你用 Symfony 3.0.x 开发了一些项目，即使直接升级到 3.4.x，理论上来说也是完全没有问题的。

说完三段式版本号，再来说说一个比较困扰 PHPer 的问题，到底 composer.json 里指定版本号的 ^ 符号和 ~ 符号到底是什么意思？有什么区别？

写这篇博客之前其实我在百度上搜了一下，想知道相关的文章是否很多，这篇文章还值得写否。搜索结果显示也的确有人总结过。虽然大都只有一个例子：

``` 
~1.2.3 代表 1.2.3 
  
根据以上搬运内容，我再补充一点点，~表示版本号只能改变最末尾那段（如果是    ~x.y
末尾就是     y
，如果是     ~x.y.z
末尾就是     z
），比如这种情况:  
  ~1.2等于>=1.2.0;<2.0.0

  
而 ^ 符号，就跟上面说了那么多的 semantic versioning 有关系了，它表示    尽量使用最新版本，但保证不产生兼容问题
，换句话说也就是除了大版本号以外，小版本号和补丁版本号都可以变。  
  但目前看来有一个很重要的细节大家都没说到，在 semantic versioning 里，0 开头的版本号是比较特殊的，而因为 ^ 严格遵守 semantic versioning 规则，所以会出现以下情况（早先的 composer 版本并没有这样的处理，后来修正了）：
  ^0.3.0等于>=0.3.0;<0.4.0

  
咦？难道不应该是    <1.0.0
吗？  
  究其原因，semantic versioning 的规定是，大版本号以 0 开头表示这是一个非稳定版本（unstable），如果处于非稳定状态，小版本号是允许不向下兼容的！所以如果你要指定 0 开头的库那一定要注意：
  ~0.1 这种写法是很危险的，因为 ~0.1 等于 >=0.1.0; <1.0.0，可能出现无法向下兼容的情况，比较保险的写法还是
  ^0.1（等于>=0.1.0;<0.2.0）



```



[0]: https://semver.org/