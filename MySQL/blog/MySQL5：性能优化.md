# [MySQL5：性能优化][0]

**性能优化**

优化MySQL数据库是数据库管理员和数据库开发人员的必备技能。MySQL优化，一方面是找出系统的瓶颈，提高MySQL数据库的整体性能；一方面需要合理的结构设计和参数调整，以提高用户操作响应的速度；同时应该尽可能节省系统资源，以便系统可以提供更大负荷的服务。

MySQL数据库优化是多方面的，有几条优化原则：

1、减少系统的瓶颈

2、减少资源的占用

3、增加系统的反应速度

**优化查询**

**1、索引对查询的影响**

我有一个book表，里面有10条记录，没有索引查询的时候：

![][1]

使用了索引： 

![][2]

看到不使用索引的时候rows为10，也就是说扫描了表中的10条记录，而使用索引，rows为1，说明扫描了表中的1条记录，其查询速度自然比不使用索引快。而且possible_keys和key的值都是BkNameIdx，说明查询时使用了BkNameIdx索引

**2、使用索引查询**

使用索引查询有几种特殊情况，特别提一下：

（1）使用LIKE关键字的查询语句

在使用LIKE关键字进行查询的查询语句中，如果匹配字符串的第一个字符为"%"，索引不会起作用，只有"%"不在第一个位置，索引才会起作用

（2）使用多列索引的查询语句

MySQL可以为多个字段创建索引，一个索引可以包含16个字段，对于多列索引，只有查询条件中使用了这些字段中第一个字段时，索引才会被使用

（3）使用OR关键字的查询语句

查询语句的查询条件中只有OR关键字，且OR前后两个条件都是索引时，查询才会使用索引，否则，查询将不使用索引

**3、避免使用SELECT *命令**

从表中读取的数据越多，查询会变得越慢，始终指定需要的列，是一个良好的习惯

**4、永远为每张表设置一个ID**

我们应该为数据库里的每张表都设置一个ID作为其主键，而且最好是一个INT型的，并设置上自动增加的AUTO_INCREMENT标识。就算有些VARCHAR字段类型的值，它永远不会重复，也不要设置为主键，使用VARCHAR类型来当主键会使性能下降

**数据库结构优化**

一个好的数据库设计方案对于数据库的性能常常会起到事半功倍的效果，合理的数据库结构不仅可以使数据库占用更小的磁盘空间，而且能够使查询速度更快。数据库结构的设计，需要考虑数据冗余、查询和更新的速度、字段的数据类型是否合理等多方面内容。

下面提供几条优化数据库结构的建议：

**1、将字段很多的表分解为多个表**

对于字段很多的表，如果有些字段的使用频率很低，可以将这些字段分离出来形成新表。因为当一个表的数据量很大时，会由于使用频率低的字段的存在而变慢，通过分解字段，可以提高表的查询效率

**2、增加中间表**

对于需要经常联合查询的表，可以建立中间表以提高查询效率。通过建立中间表，把需要经常联合查询的数据插入到中间表，然后将原来的联合查询改为对中间表的查询，以此来提高查询效率

**3、优化插入记录的速度**

插入记录时，影响插入速度的主要是索引、唯一性校验、一次插入记录条数等，根据这些情况，可以分别进行优化（以使用InnoDB的表为例）：

**（1）禁用唯一性检查**

插入数据时，MySQL会对插入的记录进行唯一性校验。这种唯一性校验也会降低插入记录的速度，为了降低这种情况对查询速度的影响，可以在插入记录之前禁用唯一性检查，等到记录插入完毕之后再开启：

    SET UNIQUE_CHECKS = 0;

开启唯一性检查：

    SET UNIQUE_CHECKS = 1;

**（2）禁用外键检查**

插入数据之前禁止对外键的检查，数据插入之后再恢复对外键的检查，禁用外键检查的语句如下：

    SET foreign_key_checks = 0;

恢复对外键检查的语句为：

    SET foreign_key_checks = 1;

**（3）禁止自动提交**

插入数据之前禁止事物的自动提交，数据导入完成之后，执行恢复自动提交操作。禁止自动提交的语句如下：

    SET autocommit = 0;

恢复自动提交的语句为：

    SET autocommit = 1;

[0]: http://www.cnblogs.com/xrq730/p/4941104.html
[1]: ./img/801753-20151105223137992-1479393399.png
[2]: ./img/801753-20151105223206914-1805110430.png