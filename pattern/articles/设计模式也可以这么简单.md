# [è®¾è®¡æ¨¡å¼ä¹Ÿå¯ä»¥è¿™ä¹ˆç®€å•](https://www.javadoop.com/post/design-pattern)

æ›´æ–°æ—¶é—´ï¼š2018-01-08

ä¸€ç›´æƒ³å†™ä¸€ç¯‡ä»‹ç»è®¾è®¡æ¨¡å¼çš„æ–‡ç« ï¼Œè®©è¯»è€…å¯ä»¥å¾ˆå¿«çœ‹å®Œï¼Œè€Œä¸”ä¸€çœ‹å°±æ‡‚ï¼Œçœ‹æ‡‚å°±ä¼šç”¨ï¼ŒåŒæ—¶ä¸ä¼šå°†å„ä¸ªæ¨¡å¼ææ··ã€‚è‡ªè®¤ä¸ºæœ¬æ–‡è¿˜æ˜¯å†™å¾—ä¸é”™çš„ğŸ˜‚ğŸ˜‚ğŸ˜‚ï¼Œæˆ‘ä¹ŸèŠ±äº†å¾ˆå¤šå¿ƒæ€æ¥å†™å’Œåšå›¾ï¼ŒåŠ›æ±‚è®©è¯»è€…çœŸçš„èƒ½çœ‹ç€ç®€å•åŒæ—¶æœ‰æ‰€æ”¶è·ã€‚

è®¾è®¡æ¨¡å¼æ˜¯å¯¹å¤§å®¶å®é™…å·¥ä½œä¸­å†™çš„å„ç§ä»£ç è¿›è¡Œé«˜å±‚æ¬¡æŠ½è±¡çš„æ€»ç»“ï¼Œå…¶ä¸­æœ€å‡ºåçš„å½“å± _Gang of Four_ (_GoF_) çš„åˆ†ç±»äº†ï¼Œä»–ä»¬å°†è®¾è®¡æ¨¡å¼åˆ†ç±»ä¸º 23 ç§ç»å…¸çš„æ¨¡å¼ï¼Œæ ¹æ®ç”¨é€”æˆ‘ä»¬åˆå¯ä»¥åˆ†ä¸ºä¸‰å¤§ç±»ï¼Œåˆ†åˆ«ä¸ºåˆ›å»ºå‹æ¨¡å¼ã€ç»“æ„å‹æ¨¡å¼å’Œè¡Œä¸ºå‹æ¨¡å¼ã€‚

æœ‰ä¸€äº›é‡è¦çš„è®¾è®¡åŸåˆ™åœ¨å¼€ç¯‡å’Œå¤§å®¶åˆ†äº«ä¸‹ï¼Œè¿™äº›åŸåˆ™å°†è´¯é€šå…¨æ–‡ï¼š

1. é¢å‘æ¥å£ç¼–ç¨‹ï¼Œè€Œä¸æ˜¯é¢å‘å®ç°ã€‚è¿™ä¸ªå¾ˆé‡è¦ï¼Œä¹Ÿæ˜¯ä¼˜é›…çš„ã€å¯æ‰©å±•çš„ä»£ç çš„ç¬¬ä¸€æ­¥ï¼Œè¿™å°±ä¸éœ€è¦å¤šè¯´äº†å§ã€‚
1. èŒè´£å•ä¸€åŸåˆ™ã€‚æ¯ä¸ªç±»éƒ½åº”è¯¥åªæœ‰ä¸€ä¸ªå•ä¸€çš„åŠŸèƒ½ï¼Œå¹¶ä¸”è¯¥åŠŸèƒ½åº”è¯¥ç”±è¿™ä¸ªç±»å®Œå…¨å°è£…èµ·æ¥ã€‚
1. å¯¹ä¿®æ”¹å…³é—­ï¼Œå¯¹æ‰©å±•å¼€æ”¾ã€‚å¯¹ä¿®æ”¹å…³é—­æ˜¯è¯´ï¼Œæˆ‘ä»¬è¾›è¾›è‹¦è‹¦åŠ ç­å†™å‡ºæ¥çš„ä»£ç ï¼Œè¯¥å®ç°çš„åŠŸèƒ½å’Œè¯¥ä¿®å¤çš„ bug éƒ½å®Œæˆäº†ï¼Œåˆ«äººå¯ä¸èƒ½è¯´æ”¹å°±æ”¹ï¼›å¯¹æ‰©å±•å¼€æ”¾å°±æ¯”è¾ƒå¥½ç†è§£äº†ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨æˆ‘ä»¬å†™å¥½çš„ä»£ç åŸºç¡€ä¸Šï¼Œå¾ˆå®¹æ˜“å®ç°æ‰©å±•ã€‚

**ç›®å½•**

* [åˆ›å»ºå‹æ¨¡å¼][0]
    * [ç®€å•å·¥å‚æ¨¡å¼][1]
    * [å·¥å‚æ¨¡å¼][2]
    * [æŠ½è±¡å·¥å‚æ¨¡å¼][3]
    * [å•ä¾‹æ¨¡å¼][4]
    * [å»ºé€ è€…æ¨¡å¼][5]
    * [åŸå‹æ¨¡å¼][6]
    * [åˆ›å»ºå‹æ¨¡å¼æ€»ç»“][7]
* [ç»“æ„å‹æ¨¡å¼][8]
    * [ä»£ç†æ¨¡å¼][9]
    * [é€‚é…å™¨æ¨¡å¼][10]
        * [é»˜è®¤é€‚é…å™¨æ¨¡å¼][11]
        * [å¯¹è±¡é€‚é…å™¨æ¨¡å¼][12]
        * [ç±»é€‚é…å™¨æ¨¡å¼][13]
        * [é€‚é…å™¨æ¨¡å¼æ€»ç»“][14]
    * [æ¡¥æ¢æ¨¡å¼][15]
    * [è£…é¥°æ¨¡å¼][16]
    * [é—¨é¢æ¨¡å¼][17]
    * [ç»„åˆæ¨¡å¼][18]
    * [äº«å…ƒæ¨¡å¼][19]
    * [ç»“æ„å‹æ¨¡å¼æ€»ç»“][20]
* [è¡Œä¸ºå‹æ¨¡å¼][21]
    * [ç­–ç•¥æ¨¡å¼][22]
    * [è§‚å¯Ÿè€…æ¨¡å¼][23]
    * [è´£ä»»é“¾æ¨¡å¼][24]
    * [æ¨¡æ¿æ–¹æ³•æ¨¡å¼][25]
    * [çŠ¶æ€æ¨¡å¼][26]
    * [è¡Œä¸ºå‹æ¨¡å¼æ€»ç»“][27]
* [æ€»ç»“][28]

## åˆ›å»ºå‹æ¨¡å¼

åˆ›å»ºå‹æ¨¡å¼çš„ä½œç”¨å°±æ˜¯åˆ›å»ºå¯¹è±¡ï¼Œè¯´åˆ°åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œæœ€ç†Ÿæ‚‰çš„å°±æ˜¯ new ä¸€ä¸ªå¯¹è±¡ï¼Œç„¶å set ç›¸å…³å±æ€§ã€‚ä½†æ˜¯ï¼Œåœ¨å¾ˆå¤šåœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ç»™å®¢æˆ·ç«¯æä¾›æ›´åŠ å‹å¥½çš„åˆ›å»ºå¯¹è±¡çš„æ–¹å¼ï¼Œå°¤å…¶æ˜¯é‚£ç§æˆ‘ä»¬å®šä¹‰äº†ç±»ï¼Œä½†æ˜¯éœ€è¦æä¾›ç»™å…¶ä»–å¼€å‘è€…ç”¨çš„æ—¶å€™ã€‚

### ç®€å•å·¥å‚æ¨¡å¼

å’Œåå­—ä¸€æ ·ç®€å•ï¼Œéå¸¸ç®€å•ï¼Œç›´æ¥ä¸Šä»£ç å§ï¼š

```java
    public class FoodFactory {
    
        public static Food makeFood(String name) {
            if (name.equals("noodle")) {
                Food noodle = new LanZhouNoodle();
                noodle.addSpicy("more");
                return noodle;
            } else if (name.equals("chicken")) {
                Food chicken = new HuangMenChicken();
                chicken.addCondiment("potato");
                return chicken;
            } else {
                return ;
            }
        }
    }
```

_å…¶ä¸­ï¼ŒLanZhouNoodle å’Œ HuangMenChicken éƒ½ç»§æ‰¿è‡ª Foodã€‚_

ç®€å•åœ°è¯´ï¼Œç®€å•å·¥å‚æ¨¡å¼é€šå¸¸å°±æ˜¯è¿™æ ·ï¼Œä¸€ä¸ªå·¥å‚ç±» XxxFactoryï¼Œé‡Œé¢æœ‰ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œæ ¹æ®æˆ‘ä»¬ä¸åŒçš„å‚æ•°ï¼Œè¿”å›ä¸åŒçš„æ´¾ç”Ÿè‡ªåŒä¸€ä¸ªçˆ¶ç±»ï¼ˆæˆ–å®ç°åŒä¸€æ¥å£ï¼‰çš„å®ä¾‹å¯¹è±¡ã€‚

> æˆ‘ä»¬å¼ºè°ƒ**> èŒè´£å•ä¸€**> åŸåˆ™ï¼Œä¸€ä¸ªç±»åªæä¾›ä¸€ç§åŠŸèƒ½ï¼ŒFoodFactory çš„åŠŸèƒ½å°±æ˜¯åªè¦è´Ÿè´£ç”Ÿäº§å„ç§ Foodã€‚

### å·¥å‚æ¨¡å¼

ç®€å•å·¥å‚æ¨¡å¼å¾ˆç®€å•ï¼Œå¦‚æœå®ƒèƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€è¦ï¼Œæˆ‘è§‰å¾—å°±ä¸è¦æŠ˜è…¾äº†ã€‚ä¹‹æ‰€ä»¥éœ€è¦å¼•å…¥å·¥å‚æ¨¡å¼ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬å¾€å¾€éœ€è¦ä½¿ç”¨ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„å·¥å‚ã€‚

```java
    public interface FoodFactory {
        Food makeFood(String name);
    }
    public class ChineseFoodFactory implements FoodFactory {
    
        @Override
        public Food makeFood(String name) {
            if (name.equals("A")) {
                return new ChineseFoodA();
            } else if (name.equals("B")) {
                return new ChineseFoodB();
            } else {
                return ;
            }
        }
    }
    public class AmericanFoodFactory implements FoodFactory {
    
        @Override
        public Food makeFood(String name) {
            if (name.equals("A")) {
                return new AmericanFoodA();
            } else if (name.equals("B")) {
                return new AmericanFoodB();
            } else {
                return ;
            }
        }
    }
```

å…¶ä¸­ï¼ŒChineseFoodAã€ChineseFoodBã€AmericanFoodAã€AmericanFoodB éƒ½æ´¾ç”Ÿè‡ª Foodã€‚

å®¢æˆ·ç«¯è°ƒç”¨ï¼š

```java
    public class APP {
        public static void main(String[] args) {
            // å…ˆé€‰æ‹©ä¸€ä¸ªå…·ä½“çš„å·¥å‚
            FoodFactory factory = new ChineseFoodFactory();
            // ç”±ç¬¬ä¸€æ­¥çš„å·¥å‚äº§ç”Ÿå…·ä½“çš„å¯¹è±¡ï¼Œä¸åŒçš„å·¥å‚é€ å‡ºä¸ä¸€æ ·çš„å¯¹è±¡
            Food food = factory.makeFood("A");
        }
    }
```

è™½ç„¶éƒ½æ˜¯è°ƒç”¨ makeFood("A") åˆ¶ä½œ A ç±»é£Ÿç‰©ï¼Œä½†æ˜¯ï¼Œä¸åŒçš„å·¥å‚ç”Ÿäº§å‡ºæ¥çš„å®Œå…¨ä¸ä¸€æ ·ã€‚

ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬éœ€è¦é€‰å–åˆé€‚çš„å·¥å‚ï¼Œç„¶åç¬¬äºŒæ­¥åŸºæœ¬ä¸Šå’Œç®€å•å·¥å‚ä¸€æ ·ã€‚

**æ ¸å¿ƒåœ¨äºï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç¬¬ä¸€æ­¥é€‰å¥½æˆ‘ä»¬éœ€è¦çš„å·¥å‚**ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬æœ‰ LogFactory æ¥å£ï¼Œå®ç°ç±»æœ‰ FileLogFactory å’Œ KafkaLogFactoryï¼Œåˆ†åˆ«å¯¹åº”å°†æ—¥å¿—å†™å…¥æ–‡ä»¶å’Œå†™å…¥ Kafka ä¸­ï¼Œæ˜¾ç„¶ï¼Œæˆ‘ä»¬å®¢æˆ·ç«¯ç¬¬ä¸€æ­¥å°±éœ€è¦å†³å®šåˆ°åº•è¦å®ä¾‹åŒ– FileLogFactory è¿˜æ˜¯ KafkaLogFactoryï¼Œè¿™å°†å†³å®šä¹‹åçš„æ‰€æœ‰çš„æ“ä½œã€‚

è™½ç„¶ç®€å•ï¼Œä¸è¿‡æˆ‘ä¹ŸæŠŠæ‰€æœ‰çš„æ„ä»¶éƒ½ç”»åˆ°ä¸€å¼ å›¾ä¸Šï¼Œè¿™æ ·è¯»è€…çœ‹ç€æ¯”è¾ƒæ¸…æ™°ï¼š

![factory-1][29]

### æŠ½è±¡å·¥å‚æ¨¡å¼

å½“æ¶‰åŠåˆ°**äº§å“æ—**çš„æ—¶å€™ï¼Œå°±éœ€è¦å¼•å…¥æŠ½è±¡å·¥å‚æ¨¡å¼äº†ã€‚

ä¸€ä¸ªç»å…¸çš„ä¾‹å­æ˜¯é€ ä¸€å°ç”µè„‘ã€‚æˆ‘ä»¬å…ˆä¸å¼•å…¥æŠ½è±¡å·¥å‚æ¨¡å¼ï¼Œçœ‹çœ‹æ€ä¹ˆå®ç°ã€‚

å› ä¸ºç”µè„‘æ˜¯ç”±è®¸å¤šçš„æ„ä»¶ç»„æˆçš„ï¼Œæˆ‘ä»¬å°† CPU å’Œä¸»æ¿è¿›è¡ŒæŠ½è±¡ï¼Œç„¶å CPU ç”± CPUFactory ç”Ÿäº§ï¼Œä¸»æ¿ç”± MainBoardFactory ç”Ÿäº§ï¼Œç„¶åï¼Œæˆ‘ä»¬å†å°† CPU å’Œä¸»æ¿æ­é…èµ·æ¥ç»„åˆåœ¨ä¸€èµ·ï¼Œå¦‚ä¸‹å›¾ï¼š

![factory-1][30]

è¿™ä¸ªæ—¶å€™çš„å®¢æˆ·ç«¯è°ƒç”¨æ˜¯è¿™æ ·çš„ï¼š

```java
    // å¾—åˆ° Intel çš„ CPU
    CPUFactory cpuFactory = new IntelCPUFactory();
    CPU cpu = intelCPUFactory.makeCPU();
    
    // å¾—åˆ° AMD çš„ä¸»æ¿
    MainBoardFactory mainBoardFactory = new AmdMainBoardFactory();
    MainBoard mainBoard = mainBoardFactory.make();
    
    // ç»„è£… CPU å’Œä¸»æ¿
    Computer computer = new Computer(cpu, mainBoard);
```

å•ç‹¬çœ‹ CPU å·¥å‚å’Œä¸»æ¿å·¥å‚ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯å‰é¢æˆ‘ä»¬è¯´çš„**å·¥å‚æ¨¡å¼**ã€‚è¿™ç§æ–¹å¼ä¹Ÿå®¹æ˜“æ‰©å±•ï¼Œå› ä¸ºè¦ç»™ç”µè„‘åŠ ç¡¬ç›˜çš„è¯ï¼Œåªéœ€è¦åŠ ä¸€ä¸ª HardDiskFactory å’Œç›¸åº”çš„å®ç°å³å¯ï¼Œä¸éœ€è¦ä¿®æ”¹ç°æœ‰çš„å·¥å‚ã€‚

ä½†æ˜¯ï¼Œè¿™ç§æ–¹å¼æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯å¦‚æœ **Intel å®¶äº§çš„ CPU å’Œ AMD äº§çš„ä¸»æ¿ä¸èƒ½å…¼å®¹ä½¿ç”¨**ï¼Œé‚£ä¹ˆè¿™ä»£ç å°±å®¹æ˜“å‡ºé”™ï¼Œå› ä¸ºå®¢æˆ·ç«¯å¹¶ä¸çŸ¥é“å®ƒä»¬ä¸å…¼å®¹ï¼Œä¹Ÿå°±ä¼šé”™è¯¯åœ°å‡ºç°éšæ„ç»„åˆã€‚

ä¸‹é¢å°±æ˜¯æˆ‘ä»¬è¦è¯´çš„**äº§å“æ—**çš„æ¦‚å¿µï¼Œå®ƒä»£è¡¨äº†ç»„æˆæŸä¸ªäº§å“çš„ä¸€ç³»åˆ—é™„ä»¶çš„é›†åˆï¼š

![abstract-factory-2][31]

å½“æ¶‰åŠåˆ°è¿™ç§äº§å“æ—çš„é—®é¢˜çš„æ—¶å€™ï¼Œå°±éœ€è¦æŠ½è±¡å·¥å‚æ¨¡å¼æ¥æ”¯æŒäº†ã€‚æˆ‘ä»¬ä¸å†å®šä¹‰ CPU å·¥å‚ã€ä¸»æ¿å·¥å‚ã€ç¡¬ç›˜å·¥å‚ã€æ˜¾ç¤ºå±å·¥å‚ç­‰ç­‰ï¼Œæˆ‘ä»¬ç›´æ¥å®šä¹‰ç”µè„‘å·¥å‚ï¼Œæ¯ä¸ªç”µè„‘å·¥å‚è´Ÿè´£ç”Ÿäº§æ‰€æœ‰çš„è®¾å¤‡ï¼Œè¿™æ ·èƒ½ä¿è¯è‚¯å®šä¸å­˜åœ¨å…¼å®¹é—®é¢˜ã€‚

![abstract-factory-3][32]

è¿™ä¸ªæ—¶å€™ï¼Œå¯¹äºå®¢æˆ·ç«¯æ¥è¯´ï¼Œä¸å†éœ€è¦å•ç‹¬æŒ‘é€‰ CPUå‚å•†ã€ä¸»æ¿å‚å•†ã€ç¡¬ç›˜å‚å•†ç­‰ï¼Œç›´æ¥é€‰æ‹©ä¸€å®¶å“ç‰Œå·¥å‚ï¼Œå“ç‰Œå·¥å‚ä¼šè´Ÿè´£ç”Ÿäº§æ‰€æœ‰çš„ä¸œè¥¿ï¼Œè€Œä¸”èƒ½ä¿è¯è‚¯å®šæ˜¯å…¼å®¹å¯ç”¨çš„ã€‚

```java
    public static void main(String[] args) {
        // ç¬¬ä¸€æ­¥å°±è¦é€‰å®šä¸€ä¸ªâ€œå¤§å‚â€
        ComputerFactory cf = new AmdFactory();
        // ä»è¿™ä¸ªå¤§å‚é€  CPU
        CPU cpu = cf.makeCPU();
        // ä»è¿™ä¸ªå¤§å‚é€ ä¸»æ¿
        MainBoard board = cf.makeMainBoard();
          // ä»è¿™ä¸ªå¤§å‚é€ ç¡¬ç›˜
          HardDisk hardDisk = cf.makeHardDisk();
    
        // å°†åŒä¸€ä¸ªå‚å­å‡ºæ¥çš„ CPUã€ä¸»æ¿ã€ç¡¬ç›˜ç»„è£…åœ¨ä¸€èµ·
        Computer result = new Computer(cpu, board, hardDisk);
    }
```

å½“ç„¶ï¼ŒæŠ½è±¡å·¥å‚çš„é—®é¢˜ä¹Ÿæ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬è¦åŠ ä¸ªæ˜¾ç¤ºå™¨ï¼Œå°±éœ€è¦ä¿®æ”¹æ‰€æœ‰çš„å·¥å‚ï¼Œç»™æ‰€æœ‰çš„å·¥å‚éƒ½åŠ ä¸Šåˆ¶é€ æ˜¾ç¤ºå™¨çš„æ–¹æ³•ã€‚è¿™æœ‰ç‚¹è¿åäº†**å¯¹ä¿®æ”¹å…³é—­ï¼Œå¯¹æ‰©å±•å¼€æ”¾**è¿™ä¸ªè®¾è®¡åŸåˆ™ã€‚

### å•ä¾‹æ¨¡å¼

å•ä¾‹æ¨¡å¼ç”¨å¾—æœ€å¤šï¼Œé”™å¾—æœ€å¤šã€‚

é¥¿æ±‰æ¨¡å¼æœ€ç®€å•ï¼š

```java
    public class Singleton {
        // é¦–å…ˆï¼Œå°† new Singleton() å µæ­»
        private Singleton() {};
        // åˆ›å»ºç§æœ‰é™æ€å®ä¾‹ï¼Œæ„å‘³ç€è¿™ä¸ªç±»ç¬¬ä¸€æ¬¡ä½¿ç”¨çš„æ—¶å€™å°±ä¼šè¿›è¡Œåˆ›å»º
        private static Singleton instance = new Singleton();
    
        public static Singleton getInstance() {
            return instance;
        }
        // çå†™ä¸€ä¸ªé™æ€æ–¹æ³•ã€‚è¿™é‡Œæƒ³è¯´çš„æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬åªæ˜¯è¦è°ƒç”¨ Singleton.getDate(...)ï¼Œ
        // æœ¬æ¥æ˜¯ä¸æƒ³è¦ç”Ÿæˆ Singleton å®ä¾‹çš„ï¼Œä¸è¿‡æ²¡åŠæ³•ï¼Œå·²ç»ç”Ÿæˆäº†
        public static Date getDate(String mode) {return new Date();}
    }
```

> å¾ˆå¤šäººéƒ½èƒ½è¯´å‡ºé¥¿æ±‰æ¨¡å¼çš„ç¼ºç‚¹ï¼Œå¯æ˜¯æˆ‘è§‰å¾—ç”Ÿäº§è¿‡ç¨‹ä¸­ï¼Œå¾ˆå°‘ç¢°åˆ°è¿™ç§æƒ…å†µï¼šä½ å®šä¹‰äº†ä¸€ä¸ªå•ä¾‹çš„ç±»ï¼Œä¸éœ€è¦å…¶å®ä¾‹ï¼Œå¯æ˜¯ä½ å´æŠŠä¸€ä¸ªæˆ–å‡ ä¸ªä½ ä¼šç”¨åˆ°çš„é™æ€æ–¹æ³•å¡åˆ°è¿™ä¸ªç±»ä¸­ã€‚

é¥±æ±‰æ¨¡å¼æœ€å®¹æ˜“å‡ºé”™ï¼š

```java
    public class Singleton {
        // é¦–å…ˆï¼Œä¹Ÿæ˜¯å…ˆå µæ­» new Singleton() è¿™æ¡è·¯
        private Singleton() {}
        // å’Œé¥¿æ±‰æ¨¡å¼ç›¸æ¯”ï¼Œè¿™è¾¹ä¸éœ€è¦å…ˆå®ä¾‹åŒ–å‡ºæ¥ï¼Œæ³¨æ„è¿™é‡Œçš„ volatileï¼Œå®ƒæ˜¯å¿…é¡»çš„
        private static volatile Singleton instance = ;
    
        public static Singleton getInstance() {
            if (instance == ) {
                // åŠ é”
                synchronized (Singleton.class) {
                    // è¿™ä¸€æ¬¡åˆ¤æ–­ä¹Ÿæ˜¯å¿…é¡»çš„ï¼Œä¸ç„¶ä¼šæœ‰å¹¶å‘é—®é¢˜
                    if (instance == ) {
                        instance = new Singleton();
                    }
                }
            }
            return instance;
        }
    }
```

> åŒé‡æ£€æŸ¥ï¼ŒæŒ‡çš„æ˜¯ä¸¤æ¬¡æ£€æŸ¥ instance æ˜¯å¦ä¸º nullã€‚

> volatile åœ¨è¿™é‡Œæ˜¯éœ€è¦çš„ï¼Œå¸Œæœ›èƒ½å¼•èµ·è¯»è€…çš„å…³æ³¨ã€‚

> å¾ˆå¤šäººä¸çŸ¥é“æ€ä¹ˆå†™ï¼Œç›´æ¥å°±åœ¨ getInstance() æ–¹æ³•ç­¾åä¸ŠåŠ ä¸Š synchronizedï¼Œè¿™å°±ä¸å¤šè¯´äº†ï¼Œæ€§èƒ½å¤ªå·®ã€‚

åµŒå¥—ç±»æœ€ç»å…¸ï¼Œä»¥åå¤§å®¶å°±ç”¨å®ƒå§ï¼š

```java
    public class Singleton3 {
    
        private Singleton3() {}
        // ä¸»è¦æ˜¯ä½¿ç”¨äº† åµŒå¥—ç±»å¯ä»¥è®¿é—®å¤–éƒ¨ç±»çš„é™æ€å±æ€§å’Œé™æ€æ–¹æ³• çš„ç‰¹æ€§
        private static class Holder {
            private static Singleton3 instance = new Singleton3();
        }
        public static Singleton3 getInstance() {
            return Holder.instance;
        }
    }
```

> æ³¨æ„ï¼Œå¾ˆå¤šäººéƒ½ä¼šæŠŠè¿™ä¸ª**> åµŒå¥—ç±»**> è¯´æˆæ˜¯**> é™æ€å†…éƒ¨ç±»**> ï¼Œä¸¥æ ¼åœ°è¯´ï¼Œå†…éƒ¨ç±»å’ŒåµŒå¥—ç±»æ˜¯ä¸ä¸€æ ·çš„ï¼Œå®ƒä»¬èƒ½è®¿é—®çš„å¤–éƒ¨ç±»æƒé™ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ã€‚

æœ€åï¼Œä¸€å®šæœ‰äººè·³å‡ºæ¥è¯´ç”¨æšä¸¾å®ç°å•ä¾‹ï¼Œæ˜¯çš„æ²¡é”™ï¼Œæšä¸¾ç±»å¾ˆç‰¹æ®Šï¼Œå®ƒåœ¨ç±»åŠ è½½çš„æ—¶å€™ä¼šåˆå§‹åŒ–é‡Œé¢çš„æ‰€æœ‰çš„å®ä¾‹ï¼Œè€Œä¸” JVM ä¿è¯äº†å®ƒä»¬ä¸ä¼šå†è¢«å®ä¾‹åŒ–ï¼Œæ‰€ä»¥å®ƒå¤©ç”Ÿå°±æ˜¯å•ä¾‹çš„ã€‚ä¸è¯´äº†ï¼Œè¯»è€…è‡ªå·±çœ‹ç€åŠå§ï¼Œä¸å»ºè®®ä½¿ç”¨ã€‚

### å»ºé€ è€…æ¨¡å¼

ç»å¸¸ç¢°è§çš„ XxxBuilder çš„ç±»ï¼Œé€šå¸¸éƒ½æ˜¯å»ºé€ è€…æ¨¡å¼çš„äº§ç‰©ã€‚å»ºé€ è€…æ¨¡å¼å…¶å®æœ‰å¾ˆå¤šçš„å˜ç§ï¼Œä½†æ˜¯å¯¹äºå®¢æˆ·ç«¯æ¥è¯´ï¼Œæˆ‘ä»¬çš„ä½¿ç”¨é€šå¸¸éƒ½æ˜¯ä¸€ä¸ªæ¨¡å¼çš„ï¼š

```java
    Food food = new FoodBuilder().a().b().c().build();
    Food food = Food.builder().a().b().c().build();
```

å¥—è·¯å°±æ˜¯å…ˆ new ä¸€ä¸ª Builderï¼Œç„¶åå¯ä»¥é“¾å¼åœ°è°ƒç”¨ä¸€å †æ–¹æ³•ï¼Œæœ€åå†è°ƒç”¨ä¸€æ¬¡ build() æ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦çš„å¯¹è±¡å°±æœ‰äº†ã€‚

æ¥ä¸€ä¸ªä¸­è§„ä¸­çŸ©çš„å»ºé€ è€…æ¨¡å¼ï¼š

```java
    class User {
        // ä¸‹é¢æ˜¯â€œä¸€å †â€çš„å±æ€§
        private String name;
        private String password;
        private String nickName;
        private int age;
    
        // æ„é€ æ–¹æ³•ç§æœ‰åŒ–ï¼Œä¸ç„¶å®¢æˆ·ç«¯å°±ä¼šç›´æ¥è°ƒç”¨æ„é€ æ–¹æ³•äº†
        private User(String name, String password, String nickName, int age) {
            this.name = name;
            this.password = password;
            this.nickName = nickName;
            this.age = age;
        }
        // é™æ€æ–¹æ³•ï¼Œç”¨äºç”Ÿæˆä¸€ä¸ª Builderï¼Œè¿™ä¸ªä¸ä¸€å®šè¦æœ‰ï¼Œä¸è¿‡å†™è¿™ä¸ªæ–¹æ³•æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¹ æƒ¯ï¼Œ
        // æœ‰äº›ä»£ç è¦æ±‚åˆ«äººå†™ new User.UserBuilder().a()...build() çœ‹ä¸Šå»å°±æ²¡é‚£ä¹ˆå¥½
        public static UserBuilder builder() {
            return new UserBuilder();
        }
    
        public static class UserBuilder {
            // ä¸‹é¢æ˜¯å’Œ User ä¸€æ¨¡ä¸€æ ·çš„ä¸€å †å±æ€§
            private String  name;
            private String password;
            private String nickName;
            private int age;
    
            private UserBuilder() {
            }
    
            // é“¾å¼è°ƒç”¨è®¾ç½®å„ä¸ªå±æ€§å€¼ï¼Œè¿”å› thisï¼Œå³ UserBuilder
            public UserBuilder name(String name) {
                this.name = name;
                return this;
            }
    
            public UserBuilder password(String password) {
                this.password = password;
                return this;
            }
    
            public UserBuilder nickName(String nickName) {
                this.nickName = nickName;
                return this;
            }
    
            public UserBuilder age(int age) {
                this.age = age;
                return this;
            }
    
            // build() æ–¹æ³•è´Ÿè´£å°† UserBuilder ä¸­è®¾ç½®å¥½çš„å±æ€§â€œå¤åˆ¶â€åˆ° User ä¸­ã€‚
            // å½“ç„¶ï¼Œå¯ä»¥åœ¨ â€œå¤åˆ¶â€ ä¹‹å‰åšç‚¹æ£€éªŒ
            public User build() {
                if (name ==  || password == ) {
                    throw new RuntimeException("ç”¨æˆ·åå’Œå¯†ç å¿…å¡«");
                }
                if (age <= 0 || age >= 150) {
                    throw new RuntimeException("å¹´é¾„ä¸åˆæ³•");
                }
                // è¿˜å¯ä»¥åšèµ‹äºˆâ€é»˜è®¤å€¼â€œçš„åŠŸèƒ½
                  if (nickName == ) {
                    nickName = name;
                }
                return new User(name, password, nickName, age);
            }
        }
    }
```

æ ¸å¿ƒæ˜¯ï¼šå…ˆæŠŠæ‰€æœ‰çš„å±æ€§éƒ½è®¾ç½®ç»™ Builderï¼Œç„¶å build() æ–¹æ³•çš„æ—¶å€™ï¼Œå°†è¿™äº›å±æ€§**å¤åˆ¶**ç»™å®é™…äº§ç”Ÿçš„å¯¹è±¡ã€‚

çœ‹çœ‹å®¢æˆ·ç«¯çš„è°ƒç”¨ï¼š

```java
    public class APP {
        public static void main(String[] args) {
            User d = User.builder()
                    .name("foo")
                    .password("pAss12345")
                    .age(25)
                    .build();
        }
    }
```

è¯´å®è¯ï¼Œå»ºé€ è€…æ¨¡å¼çš„**é“¾å¼**å†™æ³•å¾ˆå¸å¼•äººï¼Œä½†æ˜¯ï¼Œå¤šå†™äº†å¾ˆå¤šâ€œæ— ç”¨â€çš„ builder çš„ä»£ç ï¼Œæ„Ÿè§‰è¿™ä¸ªæ¨¡å¼æ²¡ä»€ä¹ˆç”¨ã€‚ä¸è¿‡ï¼Œå½“å±æ€§å¾ˆå¤šï¼Œè€Œä¸”æœ‰äº›å¿…å¡«ï¼Œæœ‰äº›é€‰å¡«çš„æ—¶å€™ï¼Œè¿™ä¸ªæ¨¡å¼ä¼šä½¿ä»£ç æ¸…æ™°å¾ˆå¤šã€‚æˆ‘ä»¬å¯ä»¥åœ¨ **Builder çš„æ„é€ æ–¹æ³•**ä¸­å¼ºåˆ¶è®©è°ƒç”¨è€…æä¾›å¿…å¡«å­—æ®µï¼Œè¿˜æœ‰ï¼Œåœ¨ build() æ–¹æ³•ä¸­æ ¡éªŒå„ä¸ªå‚æ•°æ¯”åœ¨ User çš„æ„é€ æ–¹æ³•ä¸­æ ¡éªŒï¼Œä»£ç è¦ä¼˜é›…ä¸€äº›ã€‚

> é¢˜å¤–è¯ï¼Œå¼ºçƒˆå»ºè®®è¯»è€…ä½¿ç”¨ lombokï¼Œç”¨äº† lombok ä»¥åï¼Œä¸Šé¢çš„ä¸€å¤§å †ä»£ç ä¼šå˜æˆå¦‚ä¸‹è¿™æ ·:

```java
    @Builder
    class User {
        private String  name;
        private String password;
        private String nickName;
        private int age;
    }
```

> æ€ä¹ˆæ ·ï¼Œçœä¸‹æ¥çš„æ—¶é—´æ˜¯ä¸æ˜¯åˆå¯ä»¥å¹²ç‚¹åˆ«çš„äº†ã€‚

å½“ç„¶ï¼Œå¦‚æœä½ åªæ˜¯æƒ³è¦é“¾å¼å†™æ³•ï¼Œä¸æƒ³è¦å»ºé€ è€…æ¨¡å¼ï¼Œæœ‰ä¸ªå¾ˆç®€å•çš„åŠæ³•ï¼ŒUser çš„ getter æ–¹æ³•ä¸å˜ï¼Œæ‰€æœ‰çš„ setter æ–¹æ³•éƒ½è®©å…¶ **return this** å°±å¯ä»¥äº†ï¼Œç„¶åå°±å¯ä»¥åƒä¸‹é¢è¿™æ ·è°ƒç”¨ï¼š

```java
    User user = new User().setName("").setPassword("").setAge(20);
```

### åŸå‹æ¨¡å¼

è¿™æ˜¯æˆ‘è¦è¯´çš„åˆ›å»ºå‹æ¨¡å¼çš„æœ€åä¸€ä¸ªè®¾è®¡æ¨¡å¼äº†ã€‚

åŸå‹æ¨¡å¼å¾ˆç®€å•ï¼šæœ‰ä¸€ä¸ªåŸå‹**å®ä¾‹**ï¼ŒåŸºäºè¿™ä¸ªåŸå‹å®ä¾‹äº§ç”Ÿæ–°çš„å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯â€œå…‹éš†â€äº†ã€‚

Object ç±»ä¸­æœ‰ä¸€ä¸ª clone() æ–¹æ³•ï¼Œå®ƒç”¨äºç”Ÿæˆä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå½“ç„¶ï¼Œå¦‚æœæˆ‘ä»¬è¦è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œjava è¦æ±‚æˆ‘ä»¬çš„ç±»å¿…é¡»å…ˆ**å®ç° Cloneable æ¥å£**ï¼Œæ­¤æ¥å£æ²¡æœ‰å®šä¹‰ä»»ä½•æ–¹æ³•ï¼Œä½†æ˜¯ä¸è¿™ä¹ˆåšçš„è¯ï¼Œåœ¨ clone() çš„æ—¶å€™ï¼Œä¼šæŠ›å‡º CloneNotSupportedException å¼‚å¸¸ã€‚

```java
    protected native Object clone() throws CloneNotSupportedException;
```

> java çš„å…‹éš†æ˜¯æµ…å…‹éš†ï¼Œç¢°åˆ°å¯¹è±¡å¼•ç”¨çš„æ—¶å€™ï¼Œå…‹éš†å‡ºæ¥çš„å¯¹è±¡å’ŒåŸå¯¹è±¡ä¸­çš„å¼•ç”¨å°†æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ã€‚é€šå¸¸å®ç°æ·±å…‹éš†çš„æ–¹æ³•æ˜¯å°†å¯¹è±¡è¿›è¡Œåºåˆ—åŒ–ï¼Œç„¶åå†è¿›è¡Œååºåˆ—åŒ–ã€‚

åŸå‹æ¨¡å¼äº†è§£åˆ°è¿™é‡Œæˆ‘è§‰å¾—å°±å¤Ÿäº†ï¼Œå„ç§å˜ç€æ³•å­è¯´è¿™ç§ä»£ç æˆ–é‚£ç§ä»£ç æ˜¯åŸå‹æ¨¡å¼ï¼Œæ²¡ä»€ä¹ˆæ„ä¹‰ã€‚

### åˆ›å»ºå‹æ¨¡å¼æ€»ç»“

åˆ›å»ºå‹æ¨¡å¼æ€»ä½“ä¸Šæ¯”è¾ƒç®€å•ï¼Œå®ƒä»¬çš„ä½œç”¨å°±æ˜¯ä¸ºäº†äº§ç”Ÿå®ä¾‹å¯¹è±¡ï¼Œç®—æ˜¯å„ç§å·¥ä½œçš„ç¬¬ä¸€æ­¥äº†ï¼Œå› ä¸ºæˆ‘ä»¬å†™çš„æ˜¯**é¢å‘å¯¹è±¡**çš„ä»£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬ç¬¬ä¸€æ­¥å½“ç„¶æ˜¯éœ€è¦åˆ›å»ºä¸€ä¸ªå¯¹è±¡äº†ã€‚

ç®€å•å·¥å‚æ¨¡å¼æœ€ç®€å•ï¼›å·¥å‚æ¨¡å¼åœ¨ç®€å•å·¥å‚æ¨¡å¼çš„åŸºç¡€ä¸Šå¢åŠ äº†é€‰æ‹©å·¥å‚çš„ç»´åº¦ï¼Œéœ€è¦ç¬¬ä¸€æ­¥é€‰æ‹©åˆé€‚çš„å·¥å‚ï¼›æŠ½è±¡å·¥å‚æ¨¡å¼æœ‰äº§å“æ—çš„æ¦‚å¿µï¼Œå¦‚æœå„ä¸ªäº§å“æ˜¯å­˜åœ¨å…¼å®¹æ€§é—®é¢˜çš„ï¼Œå°±è¦ç”¨æŠ½è±¡å·¥å‚æ¨¡å¼ã€‚å•ä¾‹æ¨¡å¼å°±ä¸è¯´äº†ï¼Œä¸ºäº†ä¿è¯å…¨å±€ä½¿ç”¨çš„æ˜¯åŒä¸€å¯¹è±¡ï¼Œä¸€æ–¹é¢æ˜¯å®‰å…¨æ€§è€ƒè™‘ï¼Œä¸€æ–¹é¢æ˜¯ä¸ºäº†èŠ‚çœèµ„æºï¼›å»ºé€ è€…æ¨¡å¼ä¸“é—¨å¯¹ä»˜å±æ€§å¾ˆå¤šçš„é‚£ç§ç±»ï¼Œä¸ºäº†è®©ä»£ç æ›´ä¼˜ç¾ï¼›åŸå‹æ¨¡å¼ç”¨å¾—æœ€å°‘ï¼Œäº†è§£å’Œ Object ç±»ä¸­çš„ clone() æ–¹æ³•ç›¸å…³çš„çŸ¥è¯†å³å¯ã€‚

## ç»“æ„å‹æ¨¡å¼

å‰é¢åˆ›å»ºå‹æ¨¡å¼ä»‹ç»äº†åˆ›å»ºå¯¹è±¡çš„ä¸€äº›è®¾è®¡æ¨¡å¼ï¼Œè¿™èŠ‚ä»‹ç»çš„ç»“æ„å‹æ¨¡å¼æ—¨åœ¨é€šè¿‡æ”¹å˜ä»£ç ç»“æ„æ¥è¾¾åˆ°è§£è€¦çš„ç›®çš„ï¼Œä½¿å¾—æˆ‘ä»¬çš„ä»£ç å®¹æ˜“ç»´æŠ¤å’Œæ‰©å±•ã€‚

### ä»£ç†æ¨¡å¼

ç¬¬ä¸€ä¸ªè¦ä»‹ç»çš„ä»£ç†æ¨¡å¼æ˜¯æœ€å¸¸ä½¿ç”¨çš„æ¨¡å¼ä¹‹ä¸€äº†ï¼Œç”¨ä¸€ä¸ªä»£ç†æ¥éšè—å…·ä½“å®ç°ç±»çš„å®ç°ç»†èŠ‚ï¼Œé€šå¸¸è¿˜ç”¨äºåœ¨çœŸå®çš„å®ç°çš„å‰åæ·»åŠ ä¸€éƒ¨åˆ†é€»è¾‘ã€‚

æ—¢ç„¶è¯´æ˜¯**ä»£ç†**ï¼Œé‚£å°±è¦å¯¹å®¢æˆ·ç«¯éšè—çœŸå®å®ç°ï¼Œç”±ä»£ç†æ¥è´Ÿè´£å®¢æˆ·ç«¯çš„æ‰€æœ‰è¯·æ±‚ã€‚å½“ç„¶ï¼Œä»£ç†åªæ˜¯ä¸ªä»£ç†ï¼Œå®ƒä¸ä¼šå®Œæˆå®é™…çš„ä¸šåŠ¡é€»è¾‘ï¼Œè€Œæ˜¯ä¸€å±‚çš®è€Œå·²ï¼Œä½†æ˜¯å¯¹äºå®¢æˆ·ç«¯æ¥è¯´ï¼Œå®ƒå¿…é¡»è¡¨ç°å¾—å°±æ˜¯å®¢æˆ·ç«¯éœ€è¦çš„çœŸå®å®ç°ã€‚

> ç†è§£**> ä»£ç†**> è¿™ä¸ªè¯ï¼Œè¿™ä¸ªæ¨¡å¼å…¶å®å°±ç®€å•äº†ã€‚

```java
    public interface FoodService {
        Food makeChicken();
        Food makeNoodle();
    }
    
    public class FoodServiceImpl implements FoodService {
        public Food makeChicken() {
              Food f = new Chicken()
            f.setChicken("1kg");
              f.setSpicy("1g");
              f.setSalt("3g");
            return f;
        }
        public Food makeNoodle() {
            Food f = new Noodle();
            f.setNoodle("500g");
            f.setSalt("5g");
            return f;
        }
    }
    
    // ä»£ç†è¦è¡¨ç°å¾—â€œå°±åƒæ˜¯â€çœŸå®å®ç°ç±»ï¼Œæ‰€ä»¥éœ€è¦å®ç° FoodService
    public class FoodServiceProxy implements FoodService {
    
        // å†…éƒ¨ä¸€å®šè¦æœ‰ä¸€ä¸ªçœŸå®çš„å®ç°ç±»ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡æ„é€ æ–¹æ³•æ³¨å…¥
        private FoodService foodService = new FoodServiceImpl();
    
        public Food makeChicken() {
            System.out.println("æˆ‘ä»¬é©¬ä¸Šè¦å¼€å§‹åˆ¶ä½œé¸¡è‚‰äº†");
    
            // å¦‚æœæˆ‘ä»¬å®šä¹‰è¿™å¥ä¸ºæ ¸å¿ƒä»£ç çš„è¯ï¼Œé‚£ä¹ˆï¼Œæ ¸å¿ƒä»£ç æ˜¯çœŸå®å®ç°ç±»åšçš„ï¼Œ
            // ä»£ç†åªæ˜¯åœ¨æ ¸å¿ƒä»£ç å‰ååšäº›â€œæ— è¶³è½»é‡â€çš„äº‹æƒ…
            Food food = foodService.makeChicken();
    
            System.out.println("é¸¡è‚‰åˆ¶ä½œå®Œæˆå•¦ï¼ŒåŠ ç‚¹èƒ¡æ¤’ç²‰"); // å¢å¼º
              food.addCondiment("pepper");
    
            return food;
        }
        public Food makeNoodle() {
            System.out.println("å‡†å¤‡åˆ¶ä½œæ‹‰é¢~");
            Food food = foodService.makeNoodle();
            System.out.println("åˆ¶ä½œå®Œæˆå•¦")
            return food;
        }
    }
```

å®¢æˆ·ç«¯è°ƒç”¨ï¼Œæ³¨æ„ï¼Œæˆ‘ä»¬è¦ç”¨ä»£ç†æ¥å®ä¾‹åŒ–æ¥å£ï¼š

```java
    // è¿™é‡Œç”¨ä»£ç†ç±»æ¥å®ä¾‹åŒ–
    FoodService foodService = new FoodServiceProxy();
    foodService.makeChicken();
```

![proxy][33]

æˆ‘ä»¬å‘ç°æ²¡æœ‰ï¼Œä»£ç†æ¨¡å¼è¯´ç™½äº†å°±æ˜¯åš **â€œæ–¹æ³•åŒ…è£…â€** æˆ–åš **â€œæ–¹æ³•å¢å¼ºâ€**ã€‚åœ¨é¢å‘åˆ‡é¢ç¼–ç¨‹ä¸­ï¼Œç®—äº†è¿˜æ˜¯ä¸è¦å¹æ§è¿™ä¸ªåè¯äº†ï¼Œåœ¨ AOP ä¸­ï¼Œå…¶å®å°±æ˜¯åŠ¨æ€ä»£ç†çš„è¿‡ç¨‹ã€‚æ¯”å¦‚ Spring ä¸­ï¼Œæˆ‘ä»¬è‡ªå·±ä¸å®šä¹‰ä»£ç†ç±»ï¼Œä½†æ˜¯ Spring ä¼šå¸®æˆ‘ä»¬åŠ¨æ€æ¥å®šä¹‰ä»£ç†ï¼Œç„¶åæŠŠæˆ‘ä»¬å®šä¹‰åœ¨ @Beforeã€@Afterã€@Around ä¸­çš„ä»£ç é€»è¾‘åŠ¨æ€æ·»åŠ åˆ°ä»£ç†ä¸­ã€‚

è¯´åˆ°åŠ¨æ€ä»£ç†ï¼Œåˆå¯ä»¥å±•å¼€è¯´ â€¦â€¦ Spring ä¸­å®ç°åŠ¨æ€ä»£ç†æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯å¦‚æœæˆ‘ä»¬çš„ç±»å®šä¹‰äº†æ¥å£ï¼Œå¦‚ UserService æ¥å£å’Œ UserServiceImpl å®ç°ï¼Œé‚£ä¹ˆé‡‡ç”¨ JDK çš„åŠ¨æ€ä»£ç†ï¼Œæ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥å»çœ‹çœ‹ java.lang.reflect.Proxy ç±»çš„æºç ï¼›å¦ä¸€ç§æ˜¯æˆ‘ä»¬è‡ªå·±æ²¡æœ‰å®šä¹‰æ¥å£çš„ï¼ŒSpring ä¼šé‡‡ç”¨ CGLIB è¿›è¡ŒåŠ¨æ€ä»£ç†ï¼Œå®ƒæ˜¯ä¸€ä¸ª jar åŒ…ï¼Œæ€§èƒ½è¿˜ä¸é”™ã€‚

### é€‚é…å™¨æ¨¡å¼

è¯´å®Œä»£ç†æ¨¡å¼ï¼Œè¯´é€‚é…å™¨æ¨¡å¼ï¼Œæ˜¯å› ä¸ºå®ƒä»¬å¾ˆç›¸ä¼¼ï¼Œè¿™é‡Œå¯ä»¥åšä¸ªæ¯”è¾ƒã€‚

é€‚é…å™¨æ¨¡å¼åšçš„å°±æ˜¯ï¼Œæœ‰ä¸€ä¸ªæ¥å£éœ€è¦å®ç°ï¼Œä½†æ˜¯æˆ‘ä»¬ç°æˆçš„å¯¹è±¡éƒ½ä¸æ»¡è¶³ï¼Œéœ€è¦åŠ ä¸€å±‚é€‚é…å™¨æ¥è¿›è¡Œé€‚é…ã€‚

é€‚é…å™¨æ¨¡å¼æ€»ä½“æ¥è¯´åˆ†ä¸‰ç§ï¼šé»˜è®¤é€‚é…å™¨æ¨¡å¼ã€å¯¹è±¡é€‚é…å™¨æ¨¡å¼ã€ç±»é€‚é…å™¨æ¨¡å¼ã€‚å…ˆä¸æ€¥ç€åˆ†æ¸…æ¥šè¿™å‡ ä¸ªï¼Œå…ˆçœ‹çœ‹ä¾‹å­å†è¯´ã€‚

#### é»˜è®¤é€‚é…å™¨æ¨¡å¼

é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹æœ€ç®€å•çš„é€‚é…å™¨æ¨¡å¼**é»˜è®¤é€‚é…å™¨æ¨¡å¼(Default Adapter)**æ˜¯æ€ä¹ˆæ ·çš„ã€‚

æˆ‘ä»¬ç”¨ Appache commons-io åŒ…ä¸­çš„ FileAlterationListener åšä¾‹å­ï¼Œæ­¤æ¥å£å®šä¹‰äº†å¾ˆå¤šçš„æ–¹æ³•ï¼Œç”¨äºå¯¹æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹è¿›è¡Œç›‘æ§ï¼Œä¸€æ—¦å‘ç”Ÿäº†å¯¹åº”çš„æ“ä½œï¼Œå°±ä¼šè§¦å‘ç›¸åº”çš„æ–¹æ³•ã€‚

```java
    public interface FileAlterationListener {
        void onStart(final FileAlterationObserver observer);
        void onDirectoryCreate(final File directory);
        void onDirectoryChange(final File directory);
        void onDirectoryDelete(final File directory);
        void onFileCreate(final File file);
        void onFileChange(final File file);
        void onFileDelete(final File file);
        void onStop(final FileAlterationObserver observer);
    }
```

æ­¤æ¥å£çš„ä¸€å¤§é—®é¢˜æ˜¯æŠ½è±¡æ–¹æ³•å¤ªå¤šäº†ï¼Œå¦‚æœæˆ‘ä»¬è¦ç”¨è¿™ä¸ªæ¥å£ï¼Œæ„å‘³ç€æˆ‘ä»¬è¦å®ç°æ¯ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œå¦‚æœæˆ‘ä»¬åªæ˜¯æƒ³è¦ç›‘æ§æ–‡ä»¶å¤¹ä¸­çš„**æ–‡ä»¶åˆ›å»º**å’Œ**æ–‡ä»¶åˆ é™¤**äº‹ä»¶ï¼Œå¯æ˜¯æˆ‘ä»¬è¿˜æ˜¯ä¸å¾—ä¸å®ç°æ‰€æœ‰çš„æ–¹æ³•ï¼Œå¾ˆæ˜æ˜¾ï¼Œè¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚

æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸‹é¢çš„ä¸€ä¸ª**é€‚é…å™¨**ï¼Œå®ƒç”¨äºå®ç°ä¸Šé¢çš„æ¥å£ï¼Œä½†æ˜¯**æ‰€æœ‰çš„æ–¹æ³•éƒ½æ˜¯ç©ºæ–¹æ³•**ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥è½¬è€Œå®šä¹‰è‡ªå·±çš„ç±»æ¥ç»§æ‰¿ä¸‹é¢è¿™ä¸ªç±»å³å¯ã€‚

```java
    public class FileAlterationListenerAdaptor implements FileAlterationListener {
    
        public void onStart(final FileAlterationObserver observer) {
        }
    
        public void onDirectoryCreate(final File directory) {
        }
    
        public void onDirectoryChange(final File directory) {
        }
    
        public void onDirectoryDelete(final File directory) {
        }
    
        public void onFileCreate(final File file) {
        }
    
        public void onFileChange(final File file) {
        }
    
        public void onFileDelete(final File file) {
        }
    
        public void onStop(final FileAlterationObserver observer) {
        }
    }
```

æ¯”å¦‚æˆ‘ä»¬å¯ä»¥å®šä¹‰ä»¥ä¸‹ç±»ï¼Œæˆ‘ä»¬ä»…ä»…éœ€è¦å®ç°æˆ‘ä»¬æƒ³å®ç°çš„æ–¹æ³•å°±å¯ä»¥äº†ï¼š

```java
    public class FileMonitor extends FileAlterationListenerAdaptor {
        public void onFileCreate(final File file) {
            // æ–‡ä»¶åˆ›å»º
            doSomething();
        }
    
        public void onFileDelete(final File file) {
            // æ–‡ä»¶åˆ é™¤
            doSomething();
        }
    }
```

å½“ç„¶ï¼Œä¸Šé¢è¯´çš„åªæ˜¯é€‚é…å™¨æ¨¡å¼çš„å…¶ä¸­ä¸€ç§ï¼Œä¹Ÿæ˜¯æœ€ç®€å•çš„ä¸€ç§ï¼Œæ— éœ€å¤šè¨€ã€‚ä¸‹é¢ï¼Œå†ä»‹ç»**â€œæ­£ç»Ÿçš„â€**é€‚é…å™¨æ¨¡å¼ã€‚

#### å¯¹è±¡é€‚é…å™¨æ¨¡å¼

æ¥çœ‹ä¸€ä¸ªã€ŠHead First è®¾è®¡æ¨¡å¼ã€‹ä¸­çš„ä¸€ä¸ªä¾‹å­ï¼Œæˆ‘ç¨å¾®ä¿®æ”¹äº†ä¸€ä¸‹ï¼Œçœ‹çœ‹æ€ä¹ˆå°†é¸¡é€‚é…æˆé¸­ï¼Œè¿™æ ·é¸¡ä¹Ÿèƒ½å½“é¸­æ¥ç”¨ã€‚å› ä¸ºï¼Œç°åœ¨é¸­è¿™ä¸ªæ¥å£ï¼Œæˆ‘ä»¬æ²¡æœ‰åˆé€‚çš„å®ç°ç±»å¯ä»¥ç”¨ï¼Œæ‰€ä»¥éœ€è¦é€‚é…å™¨ã€‚

```java
    public interface Duck {
        public void quack(); // é¸­çš„å‘±å‘±å«
          public void fly(); // é£
    }
    
    public interface Cock {
        public void gobble(); // é¸¡çš„å’•å’•å«
          public void fly(); // é£
    }
    
    public class WildCock implements Cock {
        public void gobble() {
            System.out.println("å’•å’•å«");
        }
          public void fly() {
            System.out.println("é¸¡ä¹Ÿä¼šé£å“¦");
        }
    }
```

é¸­æ¥å£æœ‰ fly() å’Œ quare() ä¸¤ä¸ªæ–¹æ³•ï¼Œé¸¡ Cock å¦‚æœè¦å†’å……é¸­ï¼Œfly() æ–¹æ³•æ˜¯ç°æˆçš„ï¼Œä½†æ˜¯é¸¡ä¸ä¼šé¸­çš„å‘±å‘±å«ï¼Œæ²¡æœ‰ quack() æ–¹æ³•ã€‚è¿™ä¸ªæ—¶å€™å°±éœ€è¦é€‚é…äº†ï¼š

```java
    // æ¯«æ— ç–‘é—®ï¼Œé¦–å…ˆï¼Œè¿™ä¸ªé€‚é…å™¨è‚¯å®šéœ€è¦ implements Duckï¼Œè¿™æ ·æ‰èƒ½å½“åšé¸­æ¥ç”¨
    public class CockAdapter implements Duck {
    
        Cock cock;
        // æ„é€ æ–¹æ³•ä¸­éœ€è¦ä¸€ä¸ªé¸¡çš„å®ä¾‹ï¼Œæ­¤ç±»å°±æ˜¯å°†è¿™åªé¸¡é€‚é…æˆé¸­æ¥ç”¨
          public CockAdapter(Cock cock) {
            this.cock = cock;
        }
    
        // å®ç°é¸­çš„å‘±å‘±å«æ–¹æ³•
          @Override
          public void quack() {
            // å†…éƒ¨å…¶å®æ˜¯ä¸€åªé¸¡çš„å’•å’•å«
            cock.gobble();
        }
    
          @Override
          public void fly() {
            cock.fly();
        }
    }
```

å®¢æˆ·ç«¯è°ƒç”¨å¾ˆç®€å•äº†ï¼š

```java
    public static void main(String[] args) {
        // æœ‰ä¸€åªé‡é¸¡
          Cock wildCock = new WildCock();
          // æˆåŠŸå°†é‡é¸¡é€‚é…æˆé¸­
          Duck duck = new CockAdapter(wildCock);
          ...
    }
```

åˆ°è¿™é‡Œï¼Œå¤§å®¶ä¹Ÿå°±çŸ¥é“äº†é€‚é…å™¨æ¨¡å¼æ˜¯æ€ä¹ˆå›äº‹äº†ã€‚æ— éæ˜¯æˆ‘ä»¬éœ€è¦ä¸€åªé¸­ï¼Œä½†æ˜¯æˆ‘ä»¬åªæœ‰ä¸€åªé¸¡ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦å®šä¹‰ä¸€ä¸ªé€‚é…å™¨ï¼Œç”±è¿™ä¸ªé€‚é…å™¨æ¥å……å½“é¸­ï¼Œä½†æ˜¯é€‚é…å™¨é‡Œé¢çš„æ–¹æ³•è¿˜æ˜¯ç”±é¸¡æ¥å®ç°çš„ã€‚

æˆ‘ä»¬ç”¨ä¸€ä¸ªå›¾æ¥ç®€å•è¯´æ˜ä¸‹ï¼š

![adapter-1][34]

ä¸Šå›¾åº”è¯¥è¿˜æ˜¯å¾ˆå®¹æ˜“ç†è§£çš„ï¼Œæˆ‘å°±ä¸åšæ›´å¤šçš„è§£é‡Šäº†ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬çœ‹çœ‹ç±»é€‚é…æ¨¡å¼æ€ä¹ˆæ ·çš„ã€‚

#### ç±»é€‚é…å™¨æ¨¡å¼

åºŸè¯å°‘è¯´ï¼Œç›´æ¥ä¸Šå›¾ï¼š

![adapter-1][35]

çœ‹åˆ°è¿™ä¸ªå›¾ï¼Œå¤§å®¶åº”è¯¥å¾ˆå®¹æ˜“ç†è§£çš„å§ï¼Œé€šè¿‡ç»§æ‰¿çš„æ–¹æ³•ï¼Œé€‚é…å™¨è‡ªåŠ¨è·å¾—äº†æ‰€éœ€è¦çš„å¤§éƒ¨åˆ†æ–¹æ³•ã€‚è¿™ä¸ªæ—¶å€™ï¼Œå®¢æˆ·ç«¯ä½¿ç”¨æ›´åŠ ç®€å•ï¼Œç›´æ¥ Target t = new SomeAdapter(); å°±å¯ä»¥äº†ã€‚

#### é€‚é…å™¨æ¨¡å¼æ€»ç»“

1. ç±»é€‚é…å’Œå¯¹è±¡é€‚é…çš„å¼‚åŒ

> ä¸€ä¸ªé‡‡ç”¨ç»§æ‰¿ï¼Œä¸€ä¸ªé‡‡ç”¨ç»„åˆï¼›

> ç±»é€‚é…å±äºé™æ€å®ç°ï¼Œå¯¹è±¡é€‚é…å±äºç»„åˆçš„åŠ¨æ€å®ç°ï¼Œå¯¹è±¡é€‚é…éœ€è¦å¤šå®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ã€‚

> æ€»ä½“æ¥è¯´ï¼Œå¯¹è±¡é€‚é…ç”¨å¾—æ¯”è¾ƒå¤šã€‚
1. é€‚é…å™¨æ¨¡å¼å’Œä»£ç†æ¨¡å¼çš„å¼‚åŒ

æ¯”è¾ƒè¿™ä¸¤ç§æ¨¡å¼ï¼Œå…¶å®æ˜¯æ¯”è¾ƒå¯¹è±¡é€‚é…å™¨æ¨¡å¼å’Œä»£ç†æ¨¡å¼ï¼Œåœ¨ä»£ç ç»“æ„ä¸Šï¼Œå®ƒä»¬å¾ˆç›¸ä¼¼ï¼Œéƒ½éœ€è¦ä¸€ä¸ªå…·ä½“çš„å®ç°ç±»çš„å®ä¾‹ã€‚ä½†æ˜¯å®ƒä»¬çš„ç›®çš„ä¸ä¸€æ ·ï¼Œä»£ç†æ¨¡å¼åšçš„æ˜¯å¢å¼ºåŸæ–¹æ³•çš„æ´»ï¼›é€‚é…å™¨åšçš„æ˜¯é€‚é…çš„æ´»ï¼Œä¸ºçš„æ˜¯æä¾›â€œæŠŠé¸¡åŒ…è£…æˆé¸­ï¼Œç„¶åå½“åšé¸­æ¥ä½¿ç”¨â€ï¼Œè€Œé¸¡å’Œé¸­å®ƒä»¬ä¹‹é—´åŸæœ¬æ²¡æœ‰ç»§æ‰¿å…³ç³»ã€‚

![adapter-5][36]

### æ¡¥æ¢æ¨¡å¼

ç†è§£æ¡¥æ¢æ¨¡å¼ï¼Œå…¶å®å°±æ˜¯ç†è§£ä»£ç æŠ½è±¡å’Œè§£è€¦ã€‚

æˆ‘ä»¬é¦–å…ˆéœ€è¦ä¸€ä¸ªæ¡¥æ¢ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®šä¹‰æä¾›çš„æ¥å£æ–¹æ³•ã€‚

```java
    public interface DrawAPI {
       public void draw(int radius, int x, int y);
    }
```

ç„¶åæ˜¯ä¸€ç³»åˆ—å®ç°ç±»ï¼š

```java
    public class RedPen implements DrawAPI {
       @Override
       public void draw(int radius, int x, int y) {
          System.out.println("ç”¨çº¢è‰²ç¬”ç”»å›¾ï¼Œradius:" + radius + ", x:" + x + ", y:" + y);
       }
    }
    public class GreenPen implements DrawAPI {
       @Override
       public void draw(int radius, int x, int y) {
          System.out.println("ç”¨ç»¿è‰²ç¬”ç”»å›¾ï¼Œradius:" + radius + ", x:" + x + ", y:" + y);
       }
    }
    public class BluePen implements DrawAPI {
       @Override
       public void draw(int radius, int x, int y) {
          System.out.println("ç”¨è“è‰²ç¬”ç”»å›¾ï¼Œradius:" + radius + ", x:" + x + ", y:" + y);
       }
    }
```

å®šä¹‰ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œæ­¤ç±»çš„å®ç°ç±»éƒ½éœ€è¦ä½¿ç”¨ DrawAPIï¼š

```java
    public abstract class Shape {
       protected DrawAPI drawAPI;
    
       protected Shape(DrawAPI drawAPI){
          this.drawAPI = drawAPI;
       }
       public abstract void draw();    
    }
```

å®šä¹‰æŠ½è±¡ç±»çš„å­ç±»ï¼š

```java
    // åœ†å½¢
    public class Circle extends Shape {
       private int radius;
    
       public Circle(int radius, DrawAPI drawAPI) {
          super(drawAPI);
          this.radius = radius;
       }
    
       public void draw() {
          drawAPI.draw(radius, 0, 0);
       }
    }
    // é•¿æ–¹å½¢
    public class Rectangle extends Shape {
        private int x;
          private int y;
    
          public Rectangle(int x, int y, DrawAPI drawAPI) {
            super(drawAPI);
              this.x = x;
              this.y = y;
        }
          public void draw() {
          drawAPI.draw(0, x, y);
       }
    }
```

æœ€åï¼Œæˆ‘ä»¬æ¥çœ‹å®¢æˆ·ç«¯æ¼”ç¤ºï¼š

```java
    public static void main(String[] args) {
        Shape greenCircle = new Circle(10, new GreenPen());
          Shape redRectangle = new Rectangle(4, 8, new RedPen());
    
          greenCircle.draw();
          redRectangle.draw();
    }
```

å¯èƒ½å¤§å®¶çœ‹ä¸Šé¢ä¸€æ­¥æ­¥è¿˜ä¸æ˜¯ç‰¹åˆ«æ¸…æ™°ï¼Œæˆ‘æŠŠæ‰€æœ‰çš„ä¸œè¥¿æ•´åˆåˆ°ä¸€å¼ å›¾ä¸Šï¼š

![bridge-1][37]

è¿™å›å¤§å®¶åº”è¯¥å°±çŸ¥é“æŠ½è±¡åœ¨å“ªé‡Œï¼Œæ€ä¹ˆè§£è€¦äº†å§ã€‚æ¡¥æ¢æ¨¡å¼çš„ä¼˜ç‚¹ä¹Ÿæ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œå°±æ˜¯éå¸¸å®¹æ˜“è¿›è¡Œæ‰©å±•ã€‚

> æœ¬èŠ‚å¼•ç”¨äº†[> è¿™é‡Œ][38]> çš„ä¾‹å­ï¼Œå¹¶å¯¹å…¶è¿›è¡Œäº†ä¿®æ”¹ã€‚

### è£…é¥°æ¨¡å¼

è¦æŠŠè£…é¥°æ¨¡å¼è¯´æ¸…æ¥šæ˜ç™½ï¼Œä¸æ˜¯ä»¶å®¹æ˜“çš„äº‹æƒ…ã€‚ä¹Ÿè®¸è¯»è€…çŸ¥é“ Java IO ä¸­çš„å‡ ä¸ªç±»æ˜¯å…¸å‹çš„è£…é¥°æ¨¡å¼çš„åº”ç”¨ï¼Œä½†æ˜¯è¯»è€…ä¸ä¸€å®šæ¸…æ¥šå…¶ä¸­çš„å…³ç³»ï¼Œä¹Ÿè®¸çœ‹å®Œå°±å¿˜äº†ï¼Œå¸Œæœ›çœ‹å®Œè¿™èŠ‚åï¼Œè¯»è€…å¯ä»¥å¯¹å…¶æœ‰æ›´æ·±çš„æ„Ÿæ‚Ÿã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸ªç®€å•çš„å›¾ï¼Œçœ‹è¿™ä¸ªå›¾çš„æ—¶å€™ï¼Œäº†è§£ä¸‹å±‚æ¬¡ç»“æ„å°±å¯ä»¥äº†ï¼š

![decorator-1][39]

æˆ‘ä»¬æ¥è¯´è¯´è£…é¥°æ¨¡å¼çš„å‡ºå‘ç‚¹ï¼Œä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ¥å£ Component å…¶å®å·²ç»æœ‰äº† ConcreteComponentA å’Œ ConcreteComponentB ä¸¤ä¸ªå®ç°ç±»äº†ï¼Œä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬è¦**å¢å¼º**è¿™ä¸¤ä¸ªå®ç°ç±»çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥é‡‡ç”¨è£…é¥°æ¨¡å¼ï¼Œç”¨å…·ä½“çš„è£…é¥°å™¨æ¥**è£…é¥°**å®ç°ç±»ï¼Œä»¥è¾¾åˆ°å¢å¼ºçš„ç›®çš„ã€‚

> ä»åå­—æ¥ç®€å•è§£é‡Šä¸‹è£…é¥°å™¨ã€‚æ—¢ç„¶è¯´æ˜¯è£…é¥°ï¼Œé‚£ä¹ˆå¾€å¾€å°±æ˜¯**> æ·»åŠ å°åŠŸèƒ½**> è¿™ç§ï¼Œè€Œä¸”ï¼Œæˆ‘ä»¬è¦æ»¡è¶³å¯ä»¥æ·»åŠ å¤šä¸ªå°åŠŸèƒ½ã€‚æœ€ç®€å•çš„ï¼Œä»£ç†æ¨¡å¼å°±å¯ä»¥å®ç°åŠŸèƒ½çš„å¢å¼ºï¼Œä½†æ˜¯ä»£ç†ä¸å®¹æ˜“å®ç°å¤šä¸ªåŠŸèƒ½çš„å¢å¼ºï¼Œå½“ç„¶ä½ å¯ä»¥è¯´ç”¨ä»£ç†åŒ…è£…ä»£ç†çš„æ–¹å¼ï¼Œä½†æ˜¯é‚£æ ·çš„è¯ä»£ç å°±å¤æ‚äº†ã€‚

é¦–å…ˆæ˜ç™½ä¸€äº›ç®€å•çš„æ¦‚å¿µï¼Œä»å›¾ä¸­æˆ‘ä»¬çœ‹åˆ°ï¼Œæ‰€æœ‰çš„å…·ä½“è£…é¥°è€…ä»¬ ConcreteDecorator_éƒ½å¯ä»¥ä½œä¸º Component æ¥ä½¿ç”¨ï¼Œå› ä¸ºå®ƒä»¬éƒ½å®ç°äº† Component ä¸­çš„æ‰€æœ‰æ¥å£ã€‚å®ƒä»¬å’Œ Component å®ç°ç±» ConcreteComponent_ çš„åŒºåˆ«æ˜¯ï¼Œå®ƒä»¬åªæ˜¯è£…é¥°è€…ï¼Œèµ·**è£…é¥°**ä½œç”¨ï¼Œä¹Ÿå°±æ˜¯å³ä½¿å®ƒä»¬çœ‹ä¸Šå»ç‰›é€¼è½°è½°ï¼Œä½†æ˜¯å®ƒä»¬éƒ½åªæ˜¯åœ¨å…·ä½“çš„å®ç°ä¸­**åŠ äº†å±‚çš®æ¥è£…é¥°**è€Œå·²ã€‚

> æ³¨æ„è¿™æ®µè¯ä¸­æ··æ‚åœ¨å„ä¸ªåè¯ä¸­çš„ Component å’Œ Decoratorï¼Œåˆ«ææ··äº†ã€‚

ä¸‹é¢æ¥çœ‹çœ‹ä¸€ä¸ªä¾‹å­ï¼Œå…ˆæŠŠè£…é¥°æ¨¡å¼å¼„æ¸…æ¥šï¼Œç„¶åå†ä»‹ç»ä¸‹ java io ä¸­çš„è£…é¥°æ¨¡å¼çš„åº”ç”¨ã€‚

æœ€è¿‘å¤§è¡—ä¸Šæµè¡Œèµ·æ¥äº†â€œå¿«ä¹æŸ æª¬â€ï¼Œæˆ‘ä»¬æŠŠå¿«ä¹æŸ æª¬çš„é¥®æ–™åˆ†ä¸ºä¸‰ç±»ï¼šçº¢èŒ¶ã€ç»¿èŒ¶ã€å’–å•¡ï¼Œåœ¨è¿™ä¸‰å¤§ç±»çš„åŸºç¡€ä¸Šï¼Œåˆå¢åŠ äº†è®¸å¤šçš„å£å‘³ï¼Œä»€ä¹ˆé‡‘æ¡”æŸ æª¬çº¢èŒ¶ã€é‡‘æ¡”æŸ æª¬çç ç»¿èŒ¶ã€èŠ’æœçº¢èŒ¶ã€èŠ’æœç»¿èŒ¶ã€èŠ’æœçç çº¢èŒ¶ã€çƒ¤çç çº¢èŒ¶ã€çƒ¤çç èŠ’æœç»¿èŒ¶ã€æ¤°é¦™èƒšèŠ½å’–å•¡ã€ç„¦ç³–å¯å¯å’–å•¡ç­‰ç­‰ï¼Œæ¯å®¶åº—éƒ½æœ‰å¾ˆé•¿çš„èœå•ï¼Œä½†æ˜¯ä»”ç»†çœ‹ä¸‹ï¼Œå…¶å®åŸæ–™ä¹Ÿæ²¡å‡ æ ·ï¼Œä½†æ˜¯å¯ä»¥æ­é…å‡ºå¾ˆå¤šç»„åˆï¼Œå¦‚æœé¡¾å®¢éœ€è¦ï¼Œå¾ˆå¤šæ²¡å‡ºç°åœ¨èœå•ä¸­çš„é¥®æ–™ä»–ä»¬ä¹Ÿæ˜¯å¯ä»¥åšçš„ã€‚

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œçº¢èŒ¶ã€ç»¿èŒ¶ã€å’–å•¡æ˜¯æœ€åŸºç¡€çš„é¥®æ–™ï¼Œå…¶ä»–çš„åƒé‡‘æ¡”æŸ æª¬ã€èŠ’æœã€çç ã€æ¤°æœã€ç„¦ç³–ç­‰éƒ½å±äºè£…é¥°ç”¨çš„ã€‚å½“ç„¶ï¼Œåœ¨å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç¡®å®å¯ä»¥åƒé—¨åº—ä¸€æ ·ï¼Œå¼€å‘è¿™äº›ç±»ï¼šLemonBlackTeaã€LemonGreenTeaã€MangoBlackTeaã€MangoLemonGreenTea......ä½†æ˜¯ï¼Œå¾ˆå¿«æˆ‘ä»¬å°±å‘ç°ï¼Œè¿™æ ·å­å¹²è‚¯å®šæ˜¯ä¸è¡Œçš„ï¼Œè¿™ä¼šå¯¼è‡´æˆ‘ä»¬éœ€è¦ç»„åˆå‡ºæ‰€æœ‰çš„å¯èƒ½ï¼Œè€Œä¸”å¦‚æœå®¢äººéœ€è¦åœ¨çº¢èŒ¶ä¸­åŠ åŒä»½æŸ æª¬æ€ä¹ˆåŠï¼Ÿä¸‰ä»½æŸ æª¬æ€ä¹ˆåŠï¼Ÿä¸‡ä¸€æœ‰ä¸ªå˜æ€è¦å››ä»½æŸ æª¬ï¼Œæ‰€ä»¥è¿™ç§åšæ³•æ˜¯ç»™è‡ªå·±æ‰¾åŠ ç­çš„ã€‚

ä¸è¯´åºŸè¯äº†ï¼Œä¸Šä»£ç ã€‚

é¦–å…ˆï¼Œå®šä¹‰é¥®æ–™æŠ½è±¡åŸºç±»ï¼š

```java
    public abstract class Beverage {
          // è¿”å›æè¿°
          public abstract String getDescription();
          // è¿”å›ä»·æ ¼
          public abstract double cost();
    }
```

ç„¶åæ˜¯ä¸‰ä¸ªåŸºç¡€é¥®æ–™å®ç°ç±»ï¼Œçº¢èŒ¶ã€ç»¿èŒ¶å’Œå’–å•¡ï¼š

```java
    public class BlackTea extends Beverage {
          public String getDescription() {
            return "çº¢èŒ¶";
        }
          public double cost() {
            return 10;
        }
    }
    public class GreenTea extends Beverage {
        public String getDescription() {
            return "ç»¿èŒ¶";
        }
          public double cost() {
            return 11;
        }
    }
    ...// å’–å•¡çœç•¥
```

å®šä¹‰è°ƒæ–™ï¼Œä¹Ÿå°±æ˜¯è£…é¥°è€…çš„åŸºç±»ï¼Œæ­¤ç±»å¿…é¡»ç»§æ‰¿è‡ª Beverageï¼š

```java
    // è°ƒæ–™
    public abstract class Condiment extends Beverage {
    
    }
```

ç„¶åæˆ‘ä»¬æ¥å®šä¹‰æŸ æª¬ã€èŠ’æœç­‰å…·ä½“çš„è°ƒæ–™ï¼Œå®ƒä»¬å±äºè£…é¥°è€…ï¼Œæ¯«æ— ç–‘é—®ï¼Œè¿™äº›è°ƒæ–™è‚¯å®šéƒ½éœ€è¦ç»§æ‰¿ Condiment ç±»ï¼š

```java
    public class Lemon extends Condiment {
        private Beverage bevarage;
          // è¿™é‡Œå¾ˆå…³é”®ï¼Œéœ€è¦ä¼ å…¥å…·ä½“çš„é¥®æ–™ï¼Œå¦‚éœ€è¦ä¼ å…¥æ²¡æœ‰è¢«è£…é¥°çš„çº¢èŒ¶æˆ–ç»¿èŒ¶ï¼Œ
          // å½“ç„¶ä¹Ÿå¯ä»¥ä¼ å…¥å·²ç»è£…é¥°å¥½çš„èŠ’æœç»¿èŒ¶ï¼Œè¿™æ ·å¯ä»¥åšèŠ’æœæŸ æª¬ç»¿èŒ¶
          public Lemon(Beverage bevarage) {
            this.bevarage = bevarage;
        }
          public String getDescription() {
            // è£…é¥°
            return bevarage.getDescription() + ", åŠ æŸ æª¬";
        }
          public double cost() {
              // è£…é¥°
            return beverage.cost() + 2; // åŠ æŸ æª¬éœ€è¦ 2 å…ƒ
        }
    }
    public class Mango extends Condiment {
        private Beverage bevarage;
          public Mango(Beverage bevarage) {
            this.bevarage = bevarage;
        }
          public String getDescription() {
            return bevarage.getDescription() + ", åŠ èŠ’æœ";
        }
          public double cost() {
            return beverage.cost() + 3; // åŠ èŠ’æœéœ€è¦ 3 å…ƒ
        }
    }
    ...// ç»™æ¯ä¸€ç§è°ƒæ–™éƒ½åŠ ä¸€ä¸ªç±»
```

çœ‹å®¢æˆ·ç«¯è°ƒç”¨ï¼š

```java
    public static void main(String[] args) {
          // é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªåŸºç¡€é¥®æ–™ï¼Œçº¢èŒ¶ã€ç»¿èŒ¶æˆ–å’–å•¡
        Beverage beverage = new GreenTea();
          // å¼€å§‹è£…é¥°
          beverage = new Lemon(beverage); // å…ˆåŠ ä¸€ä»½æŸ æª¬
          beverage = new Mongo(beverage); // å†åŠ ä¸€ä»½èŠ’æœ
    
          System.out.println(beverage.getDescription() + " ä»·æ ¼ï¼šï¿¥" + beverage.cost());
          //"ç»¿èŒ¶, åŠ æŸ æª¬, åŠ èŠ’æœ ä»·æ ¼ï¼šï¿¥16"
    }
```

å¦‚æœæˆ‘ä»¬éœ€è¦èŠ’æœçç åŒä»½æŸ æª¬çº¢èŒ¶ï¼š

```java
    Beverage beverage = new Mongo(new Pearl(new Lemon(new Lemon(new BlackTea()))));
```

æ˜¯ä¸æ˜¯å¾ˆå˜æ€ï¼Ÿ

çœ‹çœ‹ä¸‹å›¾å¯èƒ½ä¼šæ¸…æ™°ä¸€äº›ï¼š

![decorator-2][40]

åˆ°è¿™é‡Œï¼Œå¤§å®¶åº”è¯¥å·²ç»æ¸…æ¥šè£…é¥°æ¨¡å¼äº†å§ã€‚

ä¸‹é¢ï¼Œæˆ‘ä»¬å†æ¥è¯´è¯´ java IO ä¸­çš„è£…é¥°æ¨¡å¼ã€‚çœ‹ä¸‹å›¾ InputStream æ´¾ç”Ÿå‡ºæ¥çš„éƒ¨åˆ†ç±»ï¼š

![decorator-3][41]

æˆ‘ä»¬çŸ¥é“ InputStream ä»£è¡¨äº†è¾“å…¥æµï¼Œå…·ä½“çš„è¾“å…¥æ¥æºå¯ä»¥æ˜¯æ–‡ä»¶ï¼ˆFileInputStreamï¼‰ã€ç®¡é“ï¼ˆPipedInputStreamï¼‰ã€æ•°ç»„ï¼ˆByteArrayInputStreamï¼‰ç­‰ï¼Œè¿™äº›å°±åƒå‰é¢å¥¶èŒ¶çš„ä¾‹å­ä¸­çš„çº¢èŒ¶ã€ç»¿èŒ¶ï¼Œå±äºåŸºç¡€è¾“å…¥æµã€‚

FilterInputStream æ‰¿æ¥äº†è£…é¥°æ¨¡å¼çš„å…³é”®èŠ‚ç‚¹ï¼Œå…¶å®ç°ç±»æ˜¯ä¸€ç³»åˆ—è£…é¥°å™¨ï¼Œæ¯”å¦‚ BufferedInputStream ä»£è¡¨ç”¨ç¼“å†²æ¥è£…é¥°ï¼Œä¹Ÿå°±ä½¿å¾—è¾“å…¥æµå…·æœ‰äº†ç¼“å†²çš„åŠŸèƒ½ï¼ŒLineNumberInputStream ä»£è¡¨ç”¨è¡Œå·æ¥è£…é¥°ï¼Œåœ¨æ“ä½œçš„æ—¶å€™å°±å¯ä»¥å–å¾—è¡Œå·äº†ï¼ŒDataInputStream çš„è£…é¥°ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥ä»è¾“å…¥æµè½¬æ¢ä¸º java ä¸­çš„åŸºæœ¬ç±»å‹å€¼ã€‚

å½“ç„¶ï¼Œåœ¨ java IO ä¸­ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨è£…é¥°å™¨çš„è¯ï¼Œå°±ä¸å¤ªé€‚åˆé¢å‘æ¥å£ç¼–ç¨‹äº†ï¼Œå¦‚ï¼š

```java
    InputStream inputStream = new LineNumberInputStream(new BufferedInputStream(new FileInputStream("")));
```

è¿™æ ·çš„ç»“æœæ˜¯ï¼ŒInputStream è¿˜æ˜¯ä¸å…·æœ‰è¯»å–è¡Œå·çš„åŠŸèƒ½ï¼Œå› ä¸ºè¯»å–è¡Œå·çš„æ–¹æ³•å®šä¹‰åœ¨ LineNumberInputStream ç±»ä¸­ã€‚

æˆ‘ä»¬åº”è¯¥åƒä¸‹é¢è¿™æ ·ä½¿ç”¨ï¼š

```java
    DataInputStream is = new DataInputStream(
                                  new BufferedInputStream(
                                      new FileInputStream("")));
```

> æ‰€ä»¥è¯´å˜›ï¼Œè¦æ‰¾åˆ°çº¯çš„ä¸¥æ ¼ç¬¦åˆè®¾è®¡æ¨¡å¼çš„ä»£ç è¿˜æ˜¯æ¯”è¾ƒéš¾çš„ã€‚

### é—¨é¢æ¨¡å¼

é—¨é¢æ¨¡å¼ï¼ˆä¹Ÿå«å¤–è§‚æ¨¡å¼ï¼ŒFacade Patternï¼‰åœ¨è®¸å¤šæºç ä¸­æœ‰ä½¿ç”¨ï¼Œæ¯”å¦‚ slf4j å°±å¯ä»¥ç†è§£ä¸ºæ˜¯é—¨é¢æ¨¡å¼çš„åº”ç”¨ã€‚è¿™æ˜¯ä¸€ä¸ªç®€å•çš„è®¾è®¡æ¨¡å¼ï¼Œæˆ‘ä»¬ç›´æ¥ä¸Šä»£ç å†è¯´å§ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ¥å£ï¼š

```java
    public interface Shape {
       void draw();
    }
```

å®šä¹‰å‡ ä¸ªå®ç°ç±»ï¼š

```java
    public class Circle implements Shape {
    
       @Override
       public void draw() {
          System.out.println("Circle::draw()");
       }
    }
    
    public class Rectangle implements Shape {
    
       @Override
       public void draw() {
          System.out.println("Rectangle::draw()");
       }
    }
```

å®¢æˆ·ç«¯è°ƒç”¨ï¼š

```java
    public static void main(String[] args) {
        // ç”»ä¸€ä¸ªåœ†å½¢
          Shape circle = new Circle();
          circle.draw();
    
          // ç”»ä¸€ä¸ªé•¿æ–¹å½¢
          Shape rectangle = new Rectangle();
          rectangle.draw();
    }
```

ä»¥ä¸Šæ˜¯æˆ‘ä»¬å¸¸å†™çš„ä»£ç ï¼Œæˆ‘ä»¬éœ€è¦ç”»åœ†å°±è¦å…ˆå®ä¾‹åŒ–åœ†ï¼Œç”»é•¿æ–¹å½¢å°±éœ€è¦å…ˆå®ä¾‹åŒ–ä¸€ä¸ªé•¿æ–¹å½¢ï¼Œç„¶åå†è°ƒç”¨ç›¸åº”çš„ draw() æ–¹æ³•ã€‚

ä¸‹é¢ï¼Œæˆ‘ä»¬çœ‹çœ‹æ€ä¹ˆç”¨é—¨é¢æ¨¡å¼æ¥è®©å®¢æˆ·ç«¯è°ƒç”¨æ›´åŠ å‹å¥½ä¸€äº›ã€‚

æˆ‘ä»¬å…ˆå®šä¹‰ä¸€ä¸ªé—¨é¢ï¼š

```java
    public class ShapeMaker {
       private Shape circle;
       private Shape rectangle;
       private Shape square;
    
       public ShapeMaker() {
          circle = new Circle();
          rectangle = new Rectangle();
          square = new Square();
       }
    
      /**
       * ä¸‹é¢å®šä¹‰ä¸€å †æ–¹æ³•ï¼Œå…·ä½“åº”è¯¥è°ƒç”¨ä»€ä¹ˆæ–¹æ³•ï¼Œç”±è¿™ä¸ªé—¨é¢æ¥å†³å®š
       */
    
       public void drawCircle(){
          circle.draw();
       }
       public void drawRectangle(){
          rectangle.draw();
       }
       public void drawSquare(){
          square.draw();
       }
    }
```

çœ‹çœ‹ç°åœ¨å®¢æˆ·ç«¯æ€ä¹ˆè°ƒç”¨ï¼š

```java
    public static void main(String[] args) {
      ShapeMaker shapeMaker = new ShapeMaker();
    
      // å®¢æˆ·ç«¯è°ƒç”¨ç°åœ¨æ›´åŠ æ¸…æ™°äº†
      shapeMaker.drawCircle();
      shapeMaker.drawRectangle();
      shapeMaker.drawSquare();        
    }
```

é—¨é¢æ¨¡å¼çš„ä¼˜ç‚¹æ˜¾è€Œæ˜“è§ï¼Œå®¢æˆ·ç«¯ä¸å†éœ€è¦å…³æ³¨å®ä¾‹åŒ–æ—¶åº”è¯¥ä½¿ç”¨å“ªä¸ªå®ç°ç±»ï¼Œç›´æ¥è°ƒç”¨é—¨é¢æä¾›çš„æ–¹æ³•å°±å¯ä»¥äº†ï¼Œå› ä¸ºé—¨é¢ç±»æä¾›çš„æ–¹æ³•çš„æ–¹æ³•åå¯¹äºå®¢æˆ·ç«¯æ¥è¯´å·²ç»å¾ˆå‹å¥½äº†ã€‚

### ç»„åˆæ¨¡å¼

ç»„åˆæ¨¡å¼ç”¨äºè¡¨ç¤ºå…·æœ‰å±‚æ¬¡ç»“æ„çš„æ•°æ®ï¼Œä½¿å¾—æˆ‘ä»¬å¯¹å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡çš„è®¿é—®å…·æœ‰ä¸€è‡´æ€§ã€‚

ç›´æ¥çœ‹ä¸€ä¸ªä¾‹å­å§ï¼Œæ¯ä¸ªå‘˜å·¥éƒ½æœ‰å§“åã€éƒ¨é—¨ã€è–ªæ°´è¿™äº›å±æ€§ï¼ŒåŒæ—¶è¿˜æœ‰ä¸‹å±å‘˜å·¥é›†åˆï¼ˆè™½ç„¶å¯èƒ½é›†åˆä¸ºç©ºï¼‰ï¼Œè€Œä¸‹å±å‘˜å·¥å’Œè‡ªå·±çš„ç»“æ„æ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿæœ‰å§“åã€éƒ¨é—¨è¿™äº›å±æ€§ï¼ŒåŒæ—¶ä¹Ÿæœ‰ä»–ä»¬çš„ä¸‹å±å‘˜å·¥é›†åˆã€‚

```java
    public class Employee {
       private String name;
       private String dept;
       private int salary;
       private List<Employee> subordinates; // ä¸‹å±
    
       public Employee(String name,String dept, int sal) {
          this.name = name;
          this.dept = dept;
          this.salary = sal;
          subordinates = new ArrayList<Employee>();
       }
    
       public void add(Employee e) {
          subordinates.add(e);
       }
    
       public void remove(Employee e) {
          subordinates.remove(e);
       }
    
       public List<Employee> getSubordinates(){
         return subordinates;
       }
    
       public String toString(){
          return ("Employee :[ Name : " + name + ", dept : " + dept + ", salary :" + salary+" ]");
       }   
    }
```

é€šå¸¸ï¼Œè¿™ç§ç±»éœ€è¦å®šä¹‰ add(node)ã€remove(node)ã€getChildren() è¿™äº›æ–¹æ³•ã€‚

è¿™è¯´çš„å…¶å®å°±æ˜¯ç»„åˆæ¨¡å¼ï¼Œè¿™ç§ç®€å•çš„æ¨¡å¼æˆ‘å°±ä¸åšè¿‡å¤šä»‹ç»äº†ï¼Œç›¸ä¿¡å„ä½è¯»è€…ä¹Ÿä¸å–œæ¬¢çœ‹æˆ‘å†™åºŸè¯ã€‚

### äº«å…ƒæ¨¡å¼

è‹±æ–‡æ˜¯ Flyweight Patternï¼Œä¸çŸ¥é“æ˜¯è°æœ€å…ˆç¿»è¯‘çš„è¿™ä¸ªè¯ï¼Œæ„Ÿè§‰è¿™ç¿»è¯‘çœŸçš„ä¸å¥½ç†è§£ï¼Œæˆ‘ä»¬è¯•ç€å¼ºè¡Œå…³è”èµ·æ¥å§ã€‚Flyweight æ˜¯è½»é‡çº§çš„æ„æ€ï¼Œäº«å…ƒåˆ†å¼€æ¥è¯´å°±æ˜¯ å…±äº« å…ƒå™¨ä»¶ï¼Œä¹Ÿå°±æ˜¯å¤ç”¨å·²ç»ç”Ÿæˆçš„å¯¹è±¡ï¼Œè¿™ç§åšæ³•å½“ç„¶ä¹Ÿå°±æ˜¯è½»é‡çº§çš„äº†ã€‚

å¤ç”¨å¯¹è±¡æœ€ç®€å•çš„æ–¹å¼æ˜¯ï¼Œç”¨ä¸€ä¸ª HashMap æ¥å­˜æ”¾æ¯æ¬¡æ–°ç”Ÿæˆçš„å¯¹è±¡ã€‚æ¯æ¬¡éœ€è¦ä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œå…ˆåˆ° HashMap ä¸­çœ‹çœ‹æœ‰æ²¡æœ‰ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå†ç”Ÿæˆæ–°çš„å¯¹è±¡ï¼Œç„¶åå°†è¿™ä¸ªå¯¹è±¡æ”¾å…¥ HashMap ä¸­ã€‚

è¿™ç§ç®€å•çš„ä»£ç æˆ‘å°±ä¸æ¼”ç¤ºäº†ã€‚

### ç»“æ„å‹æ¨¡å¼æ€»ç»“

å‰é¢ï¼Œæˆ‘ä»¬è¯´äº†ä»£ç†æ¨¡å¼ã€é€‚é…å™¨æ¨¡å¼ã€æ¡¥æ¢æ¨¡å¼ã€è£…é¥°æ¨¡å¼ã€é—¨é¢æ¨¡å¼ã€ç»„åˆæ¨¡å¼å’Œäº«å…ƒæ¨¡å¼ã€‚è¯»è€…æ˜¯å¦å¯ä»¥åˆ†åˆ«æŠŠè¿™å‡ ä¸ªæ¨¡å¼è¯´æ¸…æ¥šäº†å‘¢ï¼Ÿåœ¨è¯´åˆ°è¿™äº›æ¨¡å¼çš„æ—¶å€™ï¼Œå¿ƒä¸­æ˜¯å¦æœ‰ä¸€ä¸ªæ¸…æ™°çš„å›¾æˆ–å¤„ç†æµç¨‹åœ¨è„‘æµ·é‡Œå‘¢ï¼Ÿ

ä»£ç†æ¨¡å¼æ˜¯åšæ–¹æ³•å¢å¼ºçš„ï¼Œé€‚é…å™¨æ¨¡å¼æ˜¯æŠŠé¸¡åŒ…è£…æˆé¸­è¿™ç§ç”¨æ¥é€‚é…æ¥å£çš„ï¼Œæ¡¥æ¢æ¨¡å¼åšåˆ°äº†å¾ˆå¥½çš„è§£è€¦ï¼Œè£…é¥°æ¨¡å¼ä»åå­—ä¸Šå°±çœ‹å¾—å‡ºæ¥ï¼Œé€‚åˆäºè£…é¥°ç±»æˆ–è€…è¯´æ˜¯å¢å¼ºç±»çš„åœºæ™¯ï¼Œé—¨é¢æ¨¡å¼çš„ä¼˜ç‚¹æ˜¯å®¢æˆ·ç«¯ä¸éœ€è¦å…³å¿ƒå®ä¾‹åŒ–è¿‡ç¨‹ï¼Œåªè¦è°ƒç”¨éœ€è¦çš„æ–¹æ³•å³å¯ï¼Œç»„åˆæ¨¡å¼ç”¨äºæè¿°å…·æœ‰å±‚æ¬¡ç»“æ„çš„æ•°æ®ï¼Œäº«å…ƒæ¨¡å¼æ˜¯ä¸ºäº†åœ¨ç‰¹å®šçš„åœºæ™¯ä¸­ç¼“å­˜å·²ç»åˆ›å»ºçš„å¯¹è±¡ï¼Œç”¨äºæé«˜æ€§èƒ½ã€‚

## è¡Œä¸ºå‹æ¨¡å¼

è¡Œä¸ºå‹æ¨¡å¼å…³æ³¨çš„æ˜¯å„ä¸ªç±»ä¹‹é—´çš„ç›¸äº’ä½œç”¨ï¼Œå°†èŒè´£åˆ’åˆ†æ¸…æ¥šï¼Œä½¿å¾—æˆ‘ä»¬çš„ä»£ç æ›´åŠ åœ°æ¸…æ™°ã€‚

### ç­–ç•¥æ¨¡å¼

ç­–ç•¥æ¨¡å¼å¤ªå¸¸ç”¨äº†ï¼Œæ‰€ä»¥æŠŠå®ƒæ”¾åˆ°æœ€å‰é¢è¿›è¡Œä»‹ç»ã€‚å®ƒæ¯”è¾ƒç®€å•ï¼Œæˆ‘å°±ä¸åºŸè¯ï¼Œç›´æ¥ç”¨ä»£ç è¯´äº‹å§ã€‚

ä¸‹é¢è®¾è®¡çš„åœºæ™¯æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦ç”»ä¸€ä¸ªå›¾å½¢ï¼Œå¯é€‰çš„ç­–ç•¥å°±æ˜¯ç”¨çº¢è‰²ç¬”æ¥ç”»ï¼Œè¿˜æ˜¯ç»¿è‰²ç¬”æ¥ç”»ï¼Œæˆ–è€…è“è‰²ç¬”æ¥ç”»ã€‚

é¦–å…ˆï¼Œå…ˆå®šä¹‰ä¸€ä¸ªç­–ç•¥æ¥å£ï¼š

```java
    public interface Strategy {
       public void draw(int radius, int x, int y);
    }
```

ç„¶åæˆ‘ä»¬å®šä¹‰å…·ä½“çš„å‡ ä¸ªç­–ç•¥ï¼š

```java
    public class RedPen implements Strategy {
       @Override
       public void draw(int radius, int x, int y) {
          System.out.println("ç”¨çº¢è‰²ç¬”ç”»å›¾ï¼Œradius:" + radius + ", x:" + x + ", y:" + y);
       }
    }
    public class GreenPen implements Strategy {
       @Override
       public void draw(int radius, int x, int y) {
          System.out.println("ç”¨ç»¿è‰²ç¬”ç”»å›¾ï¼Œradius:" + radius + ", x:" + x + ", y:" + y);
       }
    }
    public class BluePen implements Strategy {
       @Override
       public void draw(int radius, int x, int y) {
          System.out.println("ç”¨è“è‰²ç¬”ç”»å›¾ï¼Œradius:" + radius + ", x:" + x + ", y:" + y);
       }
    }
```

ä½¿ç”¨ç­–ç•¥çš„ç±»ï¼š

```java
    public class Context {
       private Strategy strategy;
    
       public Context(Strategy strategy){
          this.strategy = strategy;
       }
    
       public int executeDraw(int radius, int x, int y){
          return strategy.draw(radius, x, y);
       }
    }
```

å®¢æˆ·ç«¯æ¼”ç¤ºï¼š

```java
    public static void main(String[] args) {
        Context context = new Context(new BluePen()); // ä½¿ç”¨ç»¿è‰²ç¬”æ¥ç”»
          context.executeDraw(10, 0, 0);
    }
```

æ”¾åˆ°ä¸€å¼ å›¾ä¸Šï¼Œè®©å¤§å®¶çœ‹å¾—æ¸…æ™°äº›ï¼š

![strategy-1][42]

è¿™ä¸ªæ—¶å€™ï¼Œå¤§å®¶æœ‰æ²¡æœ‰è”æƒ³åˆ°ç»“æ„å‹æ¨¡å¼ä¸­çš„æ¡¥æ¢æ¨¡å¼ï¼Œå®ƒä»¬å…¶å®éå¸¸ç›¸ä¼¼ï¼Œæˆ‘æŠŠæ¡¥æ¢æ¨¡å¼çš„å›¾æ‹¿è¿‡æ¥å¤§å®¶å¯¹æ¯”ä¸‹ï¼š

![bridge-1][37]

è¦æˆ‘è¯´çš„è¯ï¼Œå®ƒä»¬éå¸¸ç›¸ä¼¼ï¼Œæ¡¥æ¢æ¨¡å¼åœ¨å·¦ä¾§åŠ äº†ä¸€å±‚æŠ½è±¡è€Œå·²ã€‚æ¡¥æ¢æ¨¡å¼çš„è€¦åˆæ›´ä½ï¼Œç»“æ„æ›´å¤æ‚ä¸€äº›ã€‚

### è§‚å¯Ÿè€…æ¨¡å¼

è§‚å¯Ÿè€…æ¨¡å¼å¯¹äºæˆ‘ä»¬æ¥è¯´ï¼ŒçœŸæ˜¯å†ç®€å•ä¸è¿‡äº†ã€‚æ— å¤–ä¹ä¸¤ä¸ªæ“ä½œï¼Œè§‚å¯Ÿè€…è®¢é˜…è‡ªå·±å…³å¿ƒçš„ä¸»é¢˜å’Œä¸»é¢˜æœ‰æ•°æ®å˜åŒ–åé€šçŸ¥è§‚å¯Ÿè€…ä»¬ã€‚

é¦–å…ˆï¼Œéœ€è¦å®šä¹‰ä¸»é¢˜ï¼Œæ¯ä¸ªä¸»é¢˜éœ€è¦æŒæœ‰è§‚å¯Ÿè€…åˆ—è¡¨çš„å¼•ç”¨ï¼Œç”¨äºåœ¨æ•°æ®å˜æ›´çš„æ—¶å€™é€šçŸ¥å„ä¸ªè§‚å¯Ÿè€…ï¼š

```java
    public class Subject {
    
       private List<Observer> observers = new ArrayList<Observer>();
       private int state;
    
       public int getState() {
          return state;
       }
    
       public void setState(int state) {
          this.state = state;
          // æ•°æ®å·²å˜æ›´ï¼Œé€šçŸ¥è§‚å¯Ÿè€…ä»¬
          notifyAllObservers();
       }
    
       public void attach(Observer observer){
          observers.add(observer);        
       }
    
       // é€šçŸ¥è§‚å¯Ÿè€…ä»¬
       public void notifyAllObservers(){
          for (Observer observer : observers) {
             observer.update();
          }
       }     
    }
```

å®šä¹‰è§‚å¯Ÿè€…æ¥å£ï¼š

```java
    public abstract class Observer {
       protected Subject subject;
       public abstract void update();
    }
```

å…¶å®å¦‚æœåªæœ‰ä¸€ä¸ªè§‚å¯Ÿè€…ç±»çš„è¯ï¼Œæ¥å£éƒ½ä¸ç”¨å®šä¹‰äº†ï¼Œä¸è¿‡ï¼Œé€šå¸¸åœºæ™¯ä¸‹ï¼Œæ—¢ç„¶ç”¨åˆ°äº†è§‚å¯Ÿè€…æ¨¡å¼ï¼Œæˆ‘ä»¬å°±æ˜¯å¸Œæœ›ä¸€ä¸ªäº‹ä»¶å‡ºæ¥äº†ï¼Œä¼šæœ‰å¤šä¸ªä¸åŒçš„ç±»éœ€è¦å¤„ç†ç›¸åº”çš„ä¿¡æ¯ã€‚æ¯”å¦‚ï¼Œè®¢å•ä¿®æ”¹æˆåŠŸäº‹ä»¶ï¼Œæˆ‘ä»¬å¸Œæœ›å‘çŸ­ä¿¡çš„ç±»å¾—åˆ°é€šçŸ¥ã€å‘é‚®ä»¶çš„ç±»å¾—åˆ°é€šçŸ¥ã€å¤„ç†ç‰©æµä¿¡æ¯çš„ç±»å¾—åˆ°é€šçŸ¥ç­‰ã€‚

æˆ‘ä»¬æ¥å®šä¹‰å…·ä½“çš„å‡ ä¸ªè§‚å¯Ÿè€…ç±»ï¼š

```java
    public class BinaryObserver extends Observer {
    
          // åœ¨æ„é€ æ–¹æ³•ä¸­è¿›è¡Œè®¢é˜…ä¸»é¢˜
        public BinaryObserver(Subject subject) {
            this.subject = subject;
            // é€šå¸¸åœ¨æ„é€ æ–¹æ³•ä¸­å°† this å‘å¸ƒå‡ºå»çš„æ“ä½œä¸€å®šè¦å°å¿ƒ
            this.subject.attach(this);
        }
    
          // è¯¥æ–¹æ³•ç”±ä¸»é¢˜ç±»åœ¨æ•°æ®å˜æ›´çš„æ—¶å€™è¿›è¡Œè°ƒç”¨
        @Override
        public void update() {
            String result = Integer.toBinaryString(subject.getState());
            System.out.println("è®¢é˜…çš„æ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œæ–°çš„æ•°æ®å¤„ç†ä¸ºäºŒè¿›åˆ¶å€¼ä¸ºï¼š" + result);
        }
    }
    
    public class HexaObserver extends Observer {
    
        public HexaObserver(Subject subject) {
            this.subject = subject;
            this.subject.attach(this);
        }
    
        @Override
        public void update() {
              String result = Integer.toHexString(subject.getState()).toUpperCase();
            System.out.println("è®¢é˜…çš„æ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œæ–°çš„æ•°æ®å¤„ç†ä¸ºåå…­è¿›åˆ¶å€¼ä¸ºï¼š" + result);
        }
    }
```

å®¢æˆ·ç«¯ä½¿ç”¨ä¹Ÿéå¸¸ç®€å•ï¼š

```java
    public static void main(String[] args) {
        // å…ˆå®šä¹‰ä¸€ä¸ªä¸»é¢˜
          Subject subject1 = new Subject();
          // å®šä¹‰è§‚å¯Ÿè€…
          new BinaryObserver(subject1);
          new HexaObserver(subject1);
    
          // æ¨¡æ‹Ÿæ•°æ®å˜æ›´ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œè§‚å¯Ÿè€…ä»¬çš„ update æ–¹æ³•å°†ä¼šè¢«è°ƒç”¨
          subject.setState(11);
    }
```

output:

```java
    è®¢é˜…çš„æ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œæ–°çš„æ•°æ®å¤„ç†ä¸ºäºŒè¿›åˆ¶å€¼ä¸ºï¼š1011
    è®¢é˜…çš„æ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œæ–°çš„æ•°æ®å¤„ç†ä¸ºåå…­è¿›åˆ¶å€¼ä¸ºï¼šB
```

å½“ç„¶ï¼Œjdk ä¹Ÿæä¾›äº†ç›¸ä¼¼çš„æ”¯æŒï¼Œå…·ä½“çš„å¤§å®¶å¯ä»¥å‚è€ƒ java.util.Observable å’Œ java.util.Observer è¿™ä¸¤ä¸ªç±»ã€‚

å®é™…ç”Ÿäº§è¿‡ç¨‹ä¸­ï¼Œè§‚å¯Ÿè€…æ¨¡å¼å¾€å¾€ç”¨æ¶ˆæ¯ä¸­é—´ä»¶æ¥å®ç°ï¼Œå¦‚æœè¦å®ç°å•æœºè§‚å¯Ÿè€…æ¨¡å¼ï¼Œç¬”è€…å»ºè®®è¯»è€…ä½¿ç”¨ Guava ä¸­çš„ EventBusï¼Œå®ƒæœ‰åŒæ­¥å®ç°ä¹Ÿæœ‰å¼‚æ­¥å®ç°ï¼Œæœ¬æ–‡ä¸»è¦ä»‹ç»è®¾è®¡æ¨¡å¼ï¼Œå°±ä¸å±•å¼€è¯´äº†ã€‚

### è´£ä»»é“¾æ¨¡å¼

è´£ä»»é“¾é€šå¸¸éœ€è¦å…ˆå»ºç«‹ä¸€ä¸ªå•å‘é“¾è¡¨ï¼Œç„¶åè°ƒç”¨æ–¹åªéœ€è¦è°ƒç”¨å¤´éƒ¨èŠ‚ç‚¹å°±å¯ä»¥äº†ï¼Œåé¢ä¼šè‡ªåŠ¨æµè½¬ä¸‹å»ã€‚æ¯”å¦‚æµç¨‹å®¡æ‰¹å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼Œåªè¦ç»ˆç«¯ç”¨æˆ·æäº¤ç”³è¯·ï¼Œæ ¹æ®ç”³è¯·çš„å†…å®¹ä¿¡æ¯ï¼Œè‡ªåŠ¨å»ºç«‹ä¸€æ¡è´£ä»»é“¾ï¼Œç„¶åå°±å¯ä»¥å¼€å§‹æµè½¬äº†ã€‚

æœ‰è¿™ä¹ˆä¸€ä¸ªåœºæ™¯ï¼Œç”¨æˆ·å‚åŠ ä¸€ä¸ªæ´»åŠ¨å¯ä»¥é¢†å–å¥–å“ï¼Œä½†æ˜¯æ´»åŠ¨éœ€è¦è¿›è¡Œå¾ˆå¤šçš„è§„åˆ™æ ¡éªŒç„¶åæ‰èƒ½æ”¾è¡Œï¼Œæ¯”å¦‚é¦–å…ˆéœ€è¦æ ¡éªŒç”¨æˆ·æ˜¯å¦æ˜¯æ–°ç”¨æˆ·ã€ä»Šæ—¥å‚ä¸äººæ•°æ˜¯å¦æœ‰é™é¢ã€å…¨åœºå‚ä¸äººæ•°æ˜¯å¦æœ‰é™é¢ç­‰ç­‰ã€‚è®¾å®šçš„è§„åˆ™éƒ½é€šè¿‡åï¼Œæ‰èƒ½è®©ç”¨æˆ·é¢†èµ°å¥–å“ã€‚

> å¦‚æœäº§å“ç»™ä½ è¿™ä¸ªéœ€æ±‚çš„è¯ï¼Œæˆ‘æƒ³å¤§éƒ¨åˆ†äººä¸€å¼€å§‹è‚¯å®šæƒ³çš„å°±æ˜¯ï¼Œç”¨ä¸€ä¸ª List æ¥å­˜æ”¾æ‰€æœ‰çš„è§„åˆ™ï¼Œç„¶å foreach æ‰§è¡Œä¸€ä¸‹æ¯ä¸ªè§„åˆ™å°±å¥½äº†ã€‚ä¸è¿‡ï¼Œè¯»è€…ä¹Ÿå…ˆåˆ«æ€¥ï¼Œçœ‹çœ‹è´£ä»»é“¾æ¨¡å¼å’Œæˆ‘ä»¬è¯´çš„è¿™ä¸ªæœ‰ä»€ä¹ˆä¸ä¸€æ ·ï¼Ÿ

é¦–å…ˆï¼Œæˆ‘ä»¬è¦å®šä¹‰æµç¨‹ä¸ŠèŠ‚ç‚¹çš„åŸºç±»ï¼š

```java
    public abstract class RuleHandler {
    
          // åç»§èŠ‚ç‚¹
        protected RuleHandler successor;
    
        public abstract void apply(Context context);
    
        public void setSuccessor(RuleHandler successor) {
            this.successor = successor;
        }
        public RuleHandler getSuccessor() {
            return successor;
        }
    }
```

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰å…·ä½“çš„æ¯ä¸ªèŠ‚ç‚¹äº†ã€‚

æ ¡éªŒç”¨æˆ·æ˜¯å¦æ˜¯æ–°ç”¨æˆ·ï¼š

```java
    public class NewUserRuleHandler extends RuleHandler {
    
        public void apply(Context context) {
            if (context.isNewUser()) {
                  // å¦‚æœæœ‰åç»§èŠ‚ç‚¹çš„è¯ï¼Œä¼ é€’ä¸‹å»
                if (this.getSuccessor() != ) {
                    this.getSuccessor().apply(context);
                }
            } else {
                throw new RuntimeException("è¯¥æ´»åŠ¨ä»…é™æ–°ç”¨æˆ·å‚ä¸");
            }
        }
    
    }
```

æ ¡éªŒç”¨æˆ·æ‰€åœ¨åœ°åŒºæ˜¯å¦å¯ä»¥å‚ä¸ï¼š

```java
    public class LocationRuleHandler extends RuleHandler {
        public void apply(Context context) {
            boolean allowed = activityService.isSupportedLocation(context.getLocation);
              if (allowed) {
                if (this.getSuccessor() != ) {
                    this.getSuccessor().apply(context);
                }
            } else  {
                throw new RuntimeException("éå¸¸æŠ±æ­‰ï¼Œæ‚¨æ‰€åœ¨çš„åœ°åŒºæ— æ³•å‚ä¸æœ¬æ¬¡æ´»åŠ¨");
            }
        }
    }
```

æ ¡éªŒå¥–å“æ˜¯å¦å·²é¢†å®Œï¼š

```java
    public class LimitRuleHandler extends RuleHandler {
        public void apply(Context context) {
              int remainedTimes = activityService.queryRemainedTimes(context); // æŸ¥è¯¢å‰©ä½™å¥–å“
            if (remainedTimes > 0) {
                if (this.getSuccessor() != ) {
                    this.getSuccessor().apply(userInfo);
                }
            } else {
                throw new RuntimeException("æ‚¨æ¥å¾—å¤ªæ™šäº†ï¼Œå¥–å“è¢«é¢†å®Œäº†");
            }
        }
    }
```

å®¢æˆ·ç«¯ï¼š

```java
    public static void main(String[] args) {
        RuleHandler newUserHandler = new NewUserRuleHandler();
          RuleHandler locationHandler = new LocationRuleHandler();
          RuleHandler limitHandler = new LimitRuleHandler();
    
          // å‡è®¾æœ¬æ¬¡æ´»åŠ¨ä»…æ ¡éªŒåœ°åŒºå’Œå¥–å“æ•°é‡ï¼Œä¸æ ¡éªŒæ–°è€ç”¨æˆ·
          locationHandler.setSuccessor(limitHandler);
          locationHandler.apply(context);
    }
```

ä»£ç å…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯å…ˆå®šä¹‰å¥½ä¸€ä¸ªé“¾è¡¨ï¼Œç„¶ååœ¨é€šè¿‡ä»»æ„ä¸€èŠ‚ç‚¹åï¼Œå¦‚æœæ­¤èŠ‚ç‚¹æœ‰åç»§èŠ‚ç‚¹ï¼Œé‚£ä¹ˆä¼ é€’ä¸‹å»ã€‚

è‡³äºå®ƒå’Œæˆ‘ä»¬å‰é¢è¯´çš„ç”¨ä¸€ä¸ª List å­˜æ”¾éœ€è¦æ‰§è¡Œçš„è§„åˆ™çš„åšæ³•æœ‰ä»€ä¹ˆå¼‚åŒï¼Œç•™ç»™è¯»è€…è‡ªå·±ç¢ç£¨å§ã€‚

### æ¨¡æ¿æ–¹æ³•æ¨¡å¼

åœ¨å«æœ‰ç»§æ‰¿ç»“æ„çš„ä»£ç ä¸­ï¼Œæ¨¡æ¿æ–¹æ³•æ¨¡å¼æ˜¯éå¸¸å¸¸ç”¨çš„ï¼Œè¿™ä¹Ÿæ˜¯åœ¨å¼€æºä»£ç ä¸­å¤§é‡è¢«ä½¿ç”¨çš„ã€‚

é€šå¸¸ä¼šæœ‰ä¸€ä¸ªæŠ½è±¡ç±»ï¼š

```java
    public abstract class AbstractTemplate {
        // è¿™å°±æ˜¯æ¨¡æ¿æ–¹æ³•
          public void templateMethod(){
            init();
            apply(); // è¿™ä¸ªæ˜¯é‡ç‚¹
            end(); // å¯ä»¥ä½œä¸ºé’©å­æ–¹æ³•
        }
        protected void init() {
            System.out.println("init æŠ½è±¡å±‚å·²ç»å®ç°ï¼Œå­ç±»ä¹Ÿå¯ä»¥é€‰æ‹©è¦†å†™");
        }
          // ç•™ç»™å­ç±»å®ç°
        protected abstract void apply();
        protected void end() {
        }
    }
```

æ¨¡æ¿æ–¹æ³•ä¸­è°ƒç”¨äº† 3 ä¸ªæ–¹æ³•ï¼Œå…¶ä¸­ apply() æ˜¯æŠ½è±¡æ–¹æ³•ï¼Œå­ç±»å¿…é¡»å®ç°å®ƒï¼Œå…¶å®æ¨¡æ¿æ–¹æ³•ä¸­æœ‰å‡ ä¸ªæŠ½è±¡æ–¹æ³•å®Œå…¨æ˜¯è‡ªç”±çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†ä¸‰ä¸ªæ–¹æ³•éƒ½è®¾ç½®ä¸ºæŠ½è±¡æ–¹æ³•ï¼Œè®©å­ç±»æ¥å®ç°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¨¡æ¿æ–¹æ³•åªè´Ÿè´£å®šä¹‰ç¬¬ä¸€æ­¥åº”è¯¥è¦åšä»€ä¹ˆï¼Œç¬¬äºŒæ­¥åº”è¯¥åšä»€ä¹ˆï¼Œç¬¬ä¸‰æ­¥åº”è¯¥åšä»€ä¹ˆï¼Œè‡³äºæ€ä¹ˆåšï¼Œç”±å­ç±»æ¥å®ç°ã€‚

æˆ‘ä»¬å†™ä¸€ä¸ªå®ç°ç±»ï¼š

```java
    public class ConcreteTemplate extends AbstractTemplate {
        public void apply() {
            System.out.println("å­ç±»å®ç°æŠ½è±¡æ–¹æ³• apply");
        }
          public void end() {
            System.out.println("æˆ‘ä»¬å¯ä»¥æŠŠ method3 å½“åšé’©å­æ–¹æ³•æ¥ä½¿ç”¨ï¼Œéœ€è¦çš„æ—¶å€™è¦†å†™å°±å¯ä»¥äº†");
        }
    }
```

å®¢æˆ·ç«¯è°ƒç”¨æ¼”ç¤ºï¼š

```java
    public static void main(String[] args) {
        AbstractTemplate t = new ConcreteTemplate();
          // è°ƒç”¨æ¨¡æ¿æ–¹æ³•
          t.templateMethod();
    }
```

ä»£ç å…¶å®å¾ˆç®€å•ï¼ŒåŸºæœ¬ä¸Šçœ‹åˆ°å°±æ‡‚äº†ï¼Œå…³é”®æ˜¯è¦å­¦ä¼šç”¨åˆ°è‡ªå·±çš„ä»£ç ä¸­ã€‚

### çŠ¶æ€æ¨¡å¼

update: 2017-10-19

åºŸè¯æˆ‘å°±ä¸è¯´äº†ï¼Œæˆ‘ä»¬è¯´ä¸€ä¸ªç®€å•çš„ä¾‹å­ã€‚å•†å“åº“å­˜ä¸­å¿ƒæœ‰ä¸ªæœ€åŸºæœ¬çš„éœ€æ±‚æ˜¯å‡åº“å­˜å’Œè¡¥åº“å­˜ï¼Œæˆ‘ä»¬çœ‹çœ‹æ€ä¹ˆç”¨çŠ¶æ€æ¨¡å¼æ¥å†™ã€‚

æ ¸å¿ƒåœ¨äºï¼Œæˆ‘ä»¬çš„å…³æ³¨ç‚¹ä¸å†æ˜¯ Context æ˜¯è¯¥è¿›è¡Œå“ªç§æ“ä½œï¼Œè€Œæ˜¯å…³æ³¨åœ¨è¿™ä¸ª Context ä¼šæœ‰å“ªäº›æ“ä½œã€‚

å®šä¹‰çŠ¶æ€æ¥å£ï¼š

```java
    public interface State {
       public void doAction(Context context);
    }
```

å®šä¹‰å‡åº“å­˜çš„çŠ¶æ€ï¼š

```java
    public class DeductState implements State {
    
       public void doAction(Context context) {
          System.out.println("å•†å“å–å‡ºï¼Œå‡†å¤‡å‡åº“å­˜");
          context.setState(this);
    
          //... æ‰§è¡Œå‡åº“å­˜çš„å…·ä½“æ“ä½œ
       }
    
       public String toString(){
          return "Deduct State";
       }
    }
```

å®šä¹‰è¡¥åº“å­˜çŠ¶æ€ï¼š

```java
    public class RevertState implements State {
        public void doAction(Context context) {
            System.out.println("ç»™æ­¤å•†å“è¡¥åº“å­˜");
              context.setState(this);
    
              //... æ‰§è¡ŒåŠ åº“å­˜çš„å…·ä½“æ“ä½œ
        }
          public String toString() {
            return "Revert State";
        }
    }
```

å‰é¢ç”¨åˆ°äº† context.setState(this)ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æ€ä¹ˆå®šä¹‰ Context ç±»ï¼š

```java
    public class Context {
        private State state;
          private String name;
          public Context(String name) {
            this.name = name;
        }
    
          public void setState(State state) {
            this.state = state;
        }
          public void getState() {
            return this.state;
        }
    }
```

æˆ‘ä»¬æ¥çœ‹ä¸‹å®¢æˆ·ç«¯è°ƒç”¨ï¼Œå¤§å®¶å°±ä¸€æ¸…äºŒæ¥šäº†ï¼š

```java
    public static void main(String[] args) {
        // æˆ‘ä»¬éœ€è¦æ“ä½œçš„æ˜¯ iPhone X
        Context context = new Context("iPhone X");
    
        // çœ‹çœ‹æ€ä¹ˆè¿›è¡Œè¡¥åº“å­˜æ“ä½œ
          State revertState = new RevertState();
          revertState.doAction(context);
    
        // åŒæ ·çš„ï¼Œå‡åº“å­˜æ“ä½œä¹Ÿéå¸¸ç®€å•
          State deductState = new DeductState();
          deductState.doAction(context);
    
          // å¦‚æœéœ€è¦æˆ‘ä»¬å¯ä»¥è·å–å½“å‰çš„çŠ¶æ€
        // context.getState().toString();
    }
```

è¯»è€…å¯èƒ½ä¼šå‘ç°ï¼Œåœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœæˆ‘ä»¬ä¸å…³å¿ƒå½“å‰ context å¤„äºä»€ä¹ˆçŠ¶æ€ï¼Œé‚£ä¹ˆ Context å°±å¯ä»¥ä¸ç”¨ç»´æŠ¤ state å±æ€§äº†ï¼Œé‚£æ ·ä»£ç ä¼šç®€å•å¾ˆå¤šã€‚

ä¸è¿‡ï¼Œå•†å“åº“å­˜è¿™ä¸ªä¾‹å­æ¯•ç«Ÿåªæ˜¯ä¸ªä¾‹ï¼Œæˆ‘ä»¬è¿˜æœ‰å¾ˆå¤šå®ä¾‹æ˜¯éœ€è¦çŸ¥é“å½“å‰ context å¤„äºä»€ä¹ˆçŠ¶æ€çš„ã€‚

### è¡Œä¸ºå‹æ¨¡å¼æ€»ç»“

è¡Œä¸ºå‹æ¨¡å¼éƒ¨åˆ†ä»‹ç»äº†ç­–ç•¥æ¨¡å¼ã€è§‚å¯Ÿè€…æ¨¡å¼ã€è´£ä»»é“¾æ¨¡å¼ã€æ¨¡æ¿æ–¹æ³•æ¨¡å¼å’ŒçŠ¶æ€æ¨¡å¼ï¼Œå…¶å®ï¼Œç»å…¸çš„è¡Œä¸ºå‹æ¨¡å¼è¿˜åŒ…æ‹¬å¤‡å¿˜å½•æ¨¡å¼ã€å‘½ä»¤æ¨¡å¼ç­‰ï¼Œä½†æ˜¯å®ƒä»¬çš„ä½¿ç”¨åœºæ™¯æ¯”è¾ƒæœ‰é™ï¼Œè€Œä¸”æœ¬æ–‡ç¯‡å¹…ä¹ŸæŒºå¤§äº†ï¼Œæˆ‘å°±ä¸è¿›è¡Œä»‹ç»äº†ã€‚

## æ€»ç»“

å­¦ä¹ è®¾è®¡æ¨¡å¼çš„ç›®çš„æ˜¯ä¸ºäº†è®©æˆ‘ä»¬çš„ä»£ç æ›´åŠ çš„ä¼˜é›…ã€æ˜“ç»´æŠ¤ã€æ˜“æ‰©å±•ã€‚æˆ‘ä»¥å‰å­¦è®¾è®¡æ¨¡å¼çš„åˆè¡·æ˜¯ä¸ºäº†çœ‹æ‡‚å¼€æºä»£ç ï¼Œä¹Ÿä¸ºäº†å†™å‡ºè£…Bçš„ä»£ç ã€‚è¿™æ¬¡æ•´ç†è¿™ç¯‡æ–‡ç« ï¼Œè®©æˆ‘é‡æ–°å®¡è§†äº†ä¸€ä¸‹å„ä¸ªè®¾è®¡æ¨¡å¼ï¼Œå¯¹æˆ‘è‡ªå·±è€Œè¨€æ”¶è·è¿˜æ˜¯æŒºå¤§çš„ã€‚æˆ‘æƒ³ï¼Œæ–‡ç« çš„æœ€å¤§æ”¶ç›Šè€…ä¸€èˆ¬éƒ½æ˜¯ä½œè€…æœ¬äººï¼Œä¸ºäº†å†™ä¸€ç¯‡æ–‡ç« ï¼Œéœ€è¦å·©å›ºè‡ªå·±çš„çŸ¥è¯†ï¼Œéœ€è¦å¯»æ‰¾å„ç§èµ„æ–™ï¼Œè€Œä¸”ï¼Œè‡ªå·±å†™è¿‡çš„æ‰æœ€å®¹æ˜“è®°ä½ï¼Œä¹Ÿç®—æ˜¯æˆ‘ç»™è¯»è€…çš„å»ºè®®å§ã€‚

ï¼ˆå…¨æ–‡å®Œï¼‰

[0]: #%E5%88%9B%E5%BB%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F
[1]: #%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F
[2]: #%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F
[3]: #%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F
[4]: #%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F
[5]: #%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F
[6]: #%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F
[7]: #%E5%88%9B%E5%BB%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F%E6%80%BB%E7%BB%93
[8]: #%E7%BB%93%E6%9E%84%E5%9E%8B%E6%A8%A1%E5%BC%8F
[9]: #%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F
[10]: #%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F
[11]: #%E9%BB%98%E8%AE%A4%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F
[12]: #%E5%AF%B9%E8%B1%A1%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F
[13]: #%E7%B1%BB%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F
[14]: #%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F%E6%80%BB%E7%BB%93
[15]: #%E6%A1%A5%E6%A2%81%E6%A8%A1%E5%BC%8F
[16]: #%E8%A3%85%E9%A5%B0%E6%A8%A1%E5%BC%8F
[17]: #%E9%97%A8%E9%9D%A2%E6%A8%A1%E5%BC%8F
[18]: #%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F
[19]: #%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F
[20]: #%E7%BB%93%E6%9E%84%E5%9E%8B%E6%A8%A1%E5%BC%8F%E6%80%BB%E7%BB%93
[21]: #%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F
[22]: #%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F
[23]: #%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F
[24]: #%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F
[25]: #%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F
[26]: #%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F
[27]: #%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F%E6%80%BB%E7%BB%93
[28]: #%E6%80%BB%E7%BB%93
[29]: https://www.javadoop.com/blogimages/design-pattern/factory-1.png
[30]: https://www.javadoop.com/blogimages/design-pattern/abstract-factory-1.png
[31]: https://www.javadoop.com/blogimages/design-pattern/abstract-factory-2.png
[32]: https://www.javadoop.com/blogimages/design-pattern/abstract-factory-3.png
[33]: https://www.javadoop.com/blogimages/design-pattern/proxy-1.png
[34]: https://www.javadoop.com/blogimages/design-pattern/adapter-1.png
[35]: https://www.javadoop.com/blogimages/design-pattern/adapter-2.png
[36]: https://www.javadoop.com/blogimages/design-pattern/adapter-5.png
[37]: https://www.javadoop.com/blogimages/design-pattern/bridge-1.png
[38]: https://www.tutorialspoint.com/design_pattern/bridge_pattern.htm
[39]: https://www.javadoop.com/blogimages/design-pattern/decorator-1.png
[40]: https://www.javadoop.com/blogimages/design-pattern/decorator-2.png
[41]: https://www.javadoop.com/blogimages/design-pattern/decorator-3.png
[42]: https://www.javadoop.com/blogimages/design-pattern/strategy-1.png