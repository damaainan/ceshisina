## 为什么我们使用 Nginx 而不是 Apache

来源：[https://www.imydl.tech/lnmp/409.html](https://www.imydl.tech/lnmp/409.html)

时间 2018-04-02 16:40:48

我们大多数的客户在他们的服务器上使用Apache作为Web服务器，尤其是部署在一个基于PHP系统的前端并且使用mod-PHP。鉴于扩张性和性能方面的原因，我们通常会建议他们改用Nginx和FPM。
 
![][0]
 
Apache是非常强大的Web服务器，模块化结构，也是Web服务端的鼻祖。除了捆绑一些其他的工具外，Apache已经成为了世上最广泛部署的开源系统，直到最近，世界上大多数网站仍运行着Apache系统。
 
但是，Apache并不是完美的，并且不再适合大规模系统。为什么？因为他的进程模式虽然简单而灵活，但并不适合大规模尤其是当要处理像PHP这种需要占用大量内存应用程序代码时。
 
一个典型的网络应用服务器由两部分组成。客户端连接部分负责用户浏览器与HTTP连接，保持长时间的TCP/IP协议，通常是1到2分钟。对于一个大型的系统，服务器可能要同时承担和处理数以万计的并发连接。
 
这直接与Apache只有500条进程即500个HTTP连接的处理能力上限相冲突。而现今的浏览器让这个问题更加严重, 因为现在的浏览器平均每个主机会打开六个网站链接（几年前是两个网站链接）。所以当超过100个用户同时访问时，Apache就已经满负荷了。
 
第二部分是应用程序处理部分，这部分承担了代码运算。在大多数系统中，这部分工作是最消耗RAM和CPU资源的，因此进程数量必须被严格限制，通常 是大约每 1GB的内存10个进程，或者每个CPU核心两个进程。因此一台4GB RAM、16内核的服务器最多只能运行32个应用程序进程。
 
但是，问题的关键是，Apache直接连接前端客户端通讯组件与后端应用程序进程组件。如此一来，前端部分往往保持长时间的连接，常常达到几分钟， 这导致后端部分将持续消耗内存和CPU资源。目前还没有直接的方法能够在大型系统中找到前后端服务的平衡，因此他们必须被分离开来。
 
目前有两个主要的解决方法。第一个方法，也是现有系统上最容易的方法，就是在Apache前端安装负载均衡服务器或者Nginx来处理客户端连接部 分。负载均衡服务器，像 HAProxy或者Nginx能轻松处理成千上万条并发的连接，并使Apache能够真正的仅作为后端应用程序工作，来处理32个或是更多的进程。
 
第二种方案，也是最通用的办法就是用Nginx替换Apache，同时使用PHP-PFM作为应用服务器。就像之前所提到的，这将分割前端客户端通信部分和后端应用程序部分。Nginx处理HTTP通讯协议，同时FPM处理后端应用程序部分，和那32个进程进行交互。
 
然而这几种方法仍然还存在一些问题，主要是如何加载服务器的RPC调用，以及如何释放已经完成的RPC调用。 这两个问题都会在后继的博客中加以详解。
 
另外，只使用Nginx的解决方法会给那些严重依赖于Apache功能的应用程序带来问题，尤其是特别依赖rewrite rules, .htaccess, 或者mod_security等一些可选组件的应用程序。在这种情况下，在Apache前端增加安装Nginx是最好的方法。
 
通常来说，所有新的系统都应该使用Nginx和PHP-FPM来部署。这能提供高性能增长特性，并且是平衡用户和内存，CPU资源的最佳选择。已存在的系统可以在前端使用Nginx或者HAProxy以达到同样的效果，以便在当今现代网络环境中为用户提供更优质的服务。
 
转载自： [http://www.ctocio.com/ccnews/11876.html][1]

[1]: http://www.ctocio.com/ccnews/11876.html
[0]: https://img0.tuicool.com/riuEniJ.png