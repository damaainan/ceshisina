## 聊一聊PHP的global

来源：[http://www.cnblogs.com/itbsl/p/10057892.html](http://www.cnblogs.com/itbsl/p/10057892.html)

时间 2018-12-03 13:14:00

 
众所周知，在PHP的函数中，如果想使用全局变量，一种是使用 **`超全局变量`** `$GLOBALS`,另一种是在函数中使用`global`关键字声明,使用超全局变量$GLOBALS的方式大家都知道了，今天来好好聊一聊使用global方式来声明变量。
 
我们来看如下例子:

```php
$a = 1;
$b = 2;
function test() {
    global $a, $b;
}
test();
```
 
当我们执行test()函数时，在内存中变量的状态是什么样的呢？如下图所示
 
![][0]
 
我们声明了test函数，当调用test()函数时，global会在函数中声明两个局部变量$a, $b,并且分别指向全局变量$a和$b,此时的临时变量$a和$b相当于全局变量$a和$b的引用。所以我们在函数中修改局部变量$a和$b的值就等同于修改了全局变量的值。

```php
$a = 1;
$b = 2;
function test() {
    global $a, $b;
    $a = 11;
    $b = 12;
    unset($a);
    unset($b);
}
test();
echo $a;
echo '<br/>';
echo $b;
```
 
浏览器上打印输出:
 
上面的代码中还使用了unset()，通过echo输出能输出全局变量$a, $b的值，这也说明test()函数里通过global关键字声明的$a和$b只是局部变量，只是断开了局部变量与全局变量的引用。
 
我们来看另一种情况，如果我们在test函数中声明的变量在全局变量中并没有呢？
 
先说结论:如果在函数中使用global关键字声明的变量在全局作用域并没有同名变量，那么会先创建同名全局变量，再在函数中创建局部变量，同时将全局变量的引用指向局部变量。

```php
function test() {
    global $a, $b;
    $a = 11;
    $b = 22;
    unset($a);
    unset($b);
}
echo $a;
echo '<br/>';
echo $b;
```
 
通过浏览器输出:
 
上面的代码，我们在test函数中使用global声明了变量$a, $b,虽然全局作用域并没有声明$a和$b,但是global依然会先创建全局变量$a和$b,然后在test函数中创建$a, $b,然后把全局变量的引用指向test函数的局部变量。所以即使我们在函数中unset了$a和$b，在函数执行完成后我们依然能打印出$a和$b,因为全局变量中已经存在着两个变量了。
 
所以我们最终可以对得出如下结论：
 
在函数中使用global声明变量时，会先在全局作用域查找是否有同名变量，如果有则将该全局变量的引用指向使用global声明的同名局部变量。如果全局作用域没有同名变量，那么就先创建同名全局变量，再创建局部变量，然后把全局变量的引用指向局部变量。


[0]: https://img1.tuicool.com/YvmyQ3f.png