# PHP中的位运算和进制处理

2016.11.25 16:52  字数 720  

PHP中的位运算和进制是比较冷门的知识,感觉很简单也很好理解,但是在实际场景中却很少使用,本篇博文就是简单了解基本概念以及讲解如何去实际使用.

#### 位运算

PHP中的位运算符是对整形进行的操作,比如对于十进制,二进制,八进制等数字的一些操作.

* `&` (按位与 AND)
* `|` (按位或 OR)
* `~` (按位取反 NOT)
* `^` (按位异或 XOR)
* `<<` (bitwise left shift)
* `>>` (bitwise right shift)

下面用一个实际例子来说明如何去使用它们,比如一个博客系统最重要的元素就是文章,而文章可以有很多**状态**,比如状态可以是删除,评论,收藏,喜欢,当然可以根据实际情况扩展,那在数据库表中如何进行设计呢?假如通过每个字段来存储文章的状态,一方面表的可扩展性很差,另外一方面查询效率很差.  
这个时候可以通过一个status字段来保存这些状态,这个字段的类型是整形,可以存储十进制,八进制,二进制,十六进制. 那么这么多状态`如何在一个字段值中表示呢,可以进行如下规定:

整数(二进制) | 状态 | 说明 
-|-|-
0001 | 删除状态 | 第一位等于1 
0010 | 评论状态 | 第二位等于1 
0100 | 收藏状态 | 第三位等于1 
1000 | 喜欢状态 | 第四位等于1 

面临的第一个问题,如何给文章增加状态属性?

    $status = $status | 0b0001 ; //文章被置为删除状态
    $status = $status | 0b0010 ; //文章被置为评论状态
    $status = $status | 0b1100 ; //文章同时被置为收藏和喜欢状态

面临的第二个问题,如何给文章取消状态属性?

    $status = $status & ~0b0001 ; //文章从删除状态恢复
    $status = $status & ~0b0010 ; //文章从评论状态恢复
    $status = $status & ~0b1100 ; //文章同时从收藏和喜欢状态恢复

面临的第三个问题,如何检查文章的状态?

    $status & 0b0001?true:false ; //查询文章是否是删除状态
    $status & 0b0010?true:false ; //查询文章是否是评论状态
    $status & 0b1100?true:false ; //查询文章是否是收藏和喜欢状态

希望通过上面的例子你能明白位运算符的作用,另外位运算符和逻辑运算符比较容易让人误解.可以这样去区分和理解:

* 位运算符是对两个整数的bits进行操作,然后返回结果,That means it's not a yes or no thing.
* 假如位运算符被用在条件语句中,他们将会进行逻辑比较.
* 逻辑操作符是比较多个表达式,然后返回true或者false.

#### 进制运算

上面位运算符的例子中,作为操作符数的都是二进制,但是也可以是其它进制.  
PHP中支持二进制(binary),八进制(octal),十进制(decimal),十六进制(hexadecimal).  
它们都是整型,进制和编码密切相关,这里仅仅说明PHP中的进制是如何表达的,以及之间是如何转换的.

如何在整型变量定义进制:

    $n = 0b10000 ; //二进制
    $n = 16; //十进制
    $n = 0x10; //十六进制
    $n = 020;//八进制
    在echo输出的时候,不管是什么类型的整数,最后输出的都是十进制

定义字符串的时候如何通过进制表示:

    //\[0-7]{1,3} #八进制表达方式
    //\x[0-9A-Fa-f]{1,2} #十六进制表达方式
    $str = "\20";
    $str = "\x10";
    echo输出的时候,会输出字符DLE

PHP内部函数如何支持进制转换,共有二种转换方式:

    $n = 16;
    echo dechex($n) . "_" . decbin($n);
    
    $n = base_convert('10',16,10 ); //'10'本身的进制由第二个参数决定
    $nn = base_convert($n, 10,2 );
    echo $n . "_" . $nn ;
    
    //以上的函数返回各进制的字符串表达形式,那么如何返回这些变量代表的字符呢.
    echo  chr(base_convert('10',16,10 ));

sprintf如何在进制中使用:  
这个函数实际上和进制没有非常耦合的关系,可以将不同进制的整型转换为不同进制的字符串表示

    $n = sprintf("%x",  0b10000 );
    $n = sprintf("%x",  0x10 );
    $n = sprintf("%x",  020 );
    $n = sprintf("%x", 16 );
    $n = sprintf("%x", "a" );
    $n = sprintf("%s",  0b10000 );
    $n = sprintf("%c",  0b10000 );#返回ASCII值对应的字符
